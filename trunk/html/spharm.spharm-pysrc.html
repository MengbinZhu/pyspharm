<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>spharm.spharm</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
</head>

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th bgcolor="#70b0f0" class="navbar-select"
          >&nbsp;&nbsp;&nbsp;Home&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

      <th class="navbar" width="100%"></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        Package&nbsp;spharm ::
        Module&nbsp;spharm
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
        <tr><td align="right"><span class="options"
            >[<a href="frames.html" target="_top">frames</a
            >]&nbsp;|&nbsp;<a href="spharm.spharm-pysrc.html"
            target="_top">no&nbsp;frames</a>]</span></td></tr>
      </table>
    </td>
  </tr>
</table>
<h1 class="epydoc">Source Code for <a href="spharm.spharm-module.html">Module spharm.spharm</a></h1>
<pre class="py-src">
<span class="py-lineno">   1</span>  <span class="py-line"><span class="py-docstring">"""</span> </span>
<span class="py-lineno">   2</span>  <span class="py-line"><span class="py-docstring">Introduction</span> </span>
<span class="py-lineno">   3</span>  <span class="py-line"><span class="py-docstring">============</span> </span>
<span class="py-lineno">   4</span>  <span class="py-line"><span class="py-docstring">    </span> </span>
<span class="py-lineno">   5</span>  <span class="py-line"><span class="py-docstring">This module provides a python interface to the NCAR </span> </span>
<span class="py-lineno">   6</span>  <span class="py-line"><span class="py-docstring">U{SPHEREPACK&lt;http://www.scd.ucar.edu/softlib/SPHERE.html&gt;} library.  </span> </span>
<span class="py-lineno">   7</span>  <span class="py-line"><span class="py-docstring">It is not a one-to-one wrapper for the SPHEREPACK routines, rather</span> </span>
<span class="py-lineno">   8</span>  <span class="py-line"><span class="py-docstring">it provides a simple interface oriented toward working with</span> </span>
<span class="py-lineno">   9</span>  <span class="py-line"><span class="py-docstring">atmospheric general circulation model (GCM) data.</span> </span>
<span class="py-lineno">  10</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">  11</span>  <span class="py-line"><span class="py-docstring">Requirements</span> </span>
<span class="py-lineno">  12</span>  <span class="py-line"><span class="py-docstring">============</span> </span>
<span class="py-lineno">  13</span>  <span class="py-line"><span class="py-docstring"> - U{numpy&lt;http://numeric.scipy.org&gt;}, and a fortran compiler</span> </span>
<span class="py-lineno">  14</span>  <span class="py-line"><span class="py-docstring"> supported by numpy.f2py.</span> </span>
<span class="py-lineno">  15</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">  16</span>  <span class="py-line"><span class="py-docstring">Installation</span> </span>
<span class="py-lineno">  17</span>  <span class="py-line"><span class="py-docstring">============</span> </span>
<span class="py-lineno">  18</span>  <span class="py-line"><span class="py-docstring"> - U{Download&lt;http://code.google.com/p/pyspharm/downloads/list&gt;} module source,</span> </span>
<span class="py-lineno">  19</span>  <span class="py-line"><span class="py-docstring"> untar.</span> </span>
<span class="py-lineno">  20</span>  <span class="py-line"><span class="py-docstring"> - run C{python setup.py install} (as root if necessary).</span> </span>
<span class="py-lineno">  21</span>  <span class="py-line"><span class="py-docstring"> The SPHERPACK fortran source files will be downloaded automatically by the</span> </span>
<span class="py-lineno">  22</span>  <span class="py-line"><span class="py-docstring"> setup.py script, since the SPHEREPACK license prohibits redistribution.</span> </span>
<span class="py-lineno">  23</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">  24</span>  <span class="py-line"><span class="py-docstring">Usage</span> </span>
<span class="py-lineno">  25</span>  <span class="py-line"><span class="py-docstring">=====</span> </span>
<span class="py-lineno">  26</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">  27</span>  <span class="py-line"><span class="py-docstring">&gt;&gt;&gt; import spharm</span> </span>
<span class="py-lineno">  28</span>  <span class="py-line"><span class="py-docstring">&gt;&gt;&gt; x=spharm.Spharmt(144,72,rsphere=8e6,gridtype='gaussian',legfunc='computed')</span> </span>
<span class="py-lineno">  29</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">  30</span>  <span class="py-line"><span class="py-docstring">creates a class instance for spherical harmonic calculations on a 144x72</span> </span>
<span class="py-lineno">  31</span>  <span class="py-line"><span class="py-docstring">gaussian grid on a sphere with radius 8000 km. The associated legendre </span> </span>
<span class="py-lineno">  32</span>  <span class="py-line"><span class="py-docstring">functions are recomputed on the fly (instead of pre-computed and stored).</span> </span>
<span class="py-lineno">  33</span>  <span class="py-line"><span class="py-docstring">Default values of rsphere, gridtype and legfunc are 6.3712e6, 'regular'</span> </span>
<span class="py-lineno">  34</span>  <span class="py-line"><span class="py-docstring">and 'stored'. Real-world examples are included in the source distribution.</span> </span>
<span class="py-lineno">  35</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">  36</span>  <span class="py-line"><span class="py-docstring">Class methods</span> </span>
<span class="py-lineno">  37</span>  <span class="py-line"><span class="py-docstring">=============</span> </span>
<span class="py-lineno">  38</span>  <span class="py-line"><span class="py-docstring"> - grdtospec: grid to spectral transform (spherical harmonic analysis).</span> </span>
<span class="py-lineno">  39</span>  <span class="py-line"><span class="py-docstring"> - spectogrd: spectral to grid transform (spherical harmonic synthesis).</span> </span>
<span class="py-lineno">  40</span>  <span class="py-line"><span class="py-docstring"> - getuv:  compute u and v winds from spectral coefficients of vorticity</span> </span>
<span class="py-lineno">  41</span>  <span class="py-line"><span class="py-docstring"> and divergence.</span> </span>
<span class="py-lineno">  42</span>  <span class="py-line"><span class="py-docstring"> - getvrtdivspec: get spectral coefficients of vorticity and divergence</span> </span>
<span class="py-lineno">  43</span>  <span class="py-line"><span class="py-docstring"> from u and v winds.</span> </span>
<span class="py-lineno">  44</span>  <span class="py-line"><span class="py-docstring"> - getgrad: compute the vector gradient given spectral coefficients.</span> </span>
<span class="py-lineno">  45</span>  <span class="py-line"><span class="py-docstring"> - getpsichi: compute streamfunction and velocity potential from winds.</span> </span>
<span class="py-lineno">  46</span>  <span class="py-line"><span class="py-docstring"> - specsmooth:  isotropic spectral smoothing.</span> </span>
<span class="py-lineno">  47</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">  48</span>  <span class="py-line"><span class="py-docstring">Functions</span> </span>
<span class="py-lineno">  49</span>  <span class="py-line"><span class="py-docstring">=========</span> </span>
<span class="py-lineno">  50</span>  <span class="py-line"><span class="py-docstring"> - regrid:  spectral re-gridding, with optional spectral smoothing and/or</span> </span>
<span class="py-lineno">  51</span>  <span class="py-line"><span class="py-docstring"> truncation.</span> </span>
<span class="py-lineno">  52</span>  <span class="py-line"><span class="py-docstring"> - gaussian_lats_wts: compute gaussian latitudes and weights.</span> </span>
<span class="py-lineno">  53</span>  <span class="py-line"><span class="py-docstring"> - getspecindx: compute indices of zonal wavenumber and degree</span> </span>
<span class="py-lineno">  54</span>  <span class="py-line"><span class="py-docstring"> for complex spherical harmonic coefficients.</span> </span>
<span class="py-lineno">  55</span>  <span class="py-line"><span class="py-docstring"> - legendre: compute associated legendre functions.</span> </span>
<span class="py-lineno">  56</span>  <span class="py-line"><span class="py-docstring"> - getgeodesicpts: computes the points on the surface of the sphere</span> </span>
<span class="py-lineno">  57</span>  <span class="py-line"><span class="py-docstring"> corresponding to a twenty-sided (icosahedral) geodesic.</span> </span>
<span class="py-lineno">  58</span>  <span class="py-line"><span class="py-docstring"> - specintrp: spectral interpolation to an arbitrary point on the sphere.</span> </span>
<span class="py-lineno">  59</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">  60</span>  <span class="py-line"><span class="py-docstring">Conventions</span> </span>
<span class="py-lineno">  61</span>  <span class="py-line"><span class="py-docstring">===========</span> </span>
<span class="py-lineno">  62</span>  <span class="py-line"><span class="py-docstring">    </span> </span>
<span class="py-lineno">  63</span>  <span class="py-line"><span class="py-docstring">The gridded data is assumed to be oriented such that i=1 is the </span> </span>
<span class="py-lineno">  64</span>  <span class="py-line"><span class="py-docstring">Greenwich meridian and j=1 is the northernmost point. Grid indices</span> </span>
<span class="py-lineno">  65</span>  <span class="py-line"><span class="py-docstring">increase eastward and southward. If nlat is odd the equator is included.</span> </span>
<span class="py-lineno">  66</span>  <span class="py-line"><span class="py-docstring">If nlat is even the equator will lie half way between points nlat/2</span> </span>
<span class="py-lineno">  67</span>  <span class="py-line"><span class="py-docstring">and (nlat/2)+1. nlat must be at least 3. For regular grids </span> </span>
<span class="py-lineno">  68</span>  <span class="py-line"><span class="py-docstring">(gridtype='regular') the poles will be included when nlat is odd.</span> </span>
<span class="py-lineno">  69</span>  <span class="py-line"><span class="py-docstring">The grid increment in longitude is 2*pi/nlon radians. For example,</span> </span>
<span class="py-lineno">  70</span>  <span class="py-line"><span class="py-docstring">nlon = 72 for a five degree grid. nlon must be greater than or </span> </span>
<span class="py-lineno">  71</span>  <span class="py-line"><span class="py-docstring">equal to 4. The efficiency of the computation is improved when nlon</span> </span>
<span class="py-lineno">  72</span>  <span class="py-line"><span class="py-docstring">is a product of small prime numbers.</span> </span>
<span class="py-lineno">  73</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">  74</span>  <span class="py-line"><span class="py-docstring">The spectral data is assumed to be in a complex array of dimension</span> </span>
<span class="py-lineno">  75</span>  <span class="py-line"><span class="py-docstring">(ntrunc+1)*(ntrunc+2)/2. ntrunc is the triangular truncation limit</span> </span>
<span class="py-lineno">  76</span>  <span class="py-line"><span class="py-docstring">(ntrunc = 42 for T42). ntrunc must be &lt;= nlat-1. Coefficients are</span> </span>
<span class="py-lineno">  77</span>  <span class="py-line"><span class="py-docstring">ordered so that first (nm=0) is m=0,n=0, second is m=0,n=1,</span> </span>
<span class="py-lineno">  78</span>  <span class="py-line"><span class="py-docstring">nm=ntrunc is m=0,n=ntrunc, nm=ntrunc+1 is m=1,n=1, etc. </span> </span>
<span class="py-lineno">  79</span>  <span class="py-line"><span class="py-docstring">The values of m (degree) and n (order) as a function of the index </span> </span>
<span class="py-lineno">  80</span>  <span class="py-line"><span class="py-docstring">nm are given by the arrays indxm, indxn returned by getspecindx.</span> </span>
<span class="py-lineno">  81</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">  82</span>  <span class="py-line"><span class="py-docstring">The associated legendre polynomials are normalized so that the</span> </span>
<span class="py-lineno">  83</span>  <span class="py-line"><span class="py-docstring">integral (pbar(n,m,theta)**2)*sin(theta) on the interval theta=0 to pi</span> </span>
<span class="py-lineno">  84</span>  <span class="py-line"><span class="py-docstring">is 1, where pbar(m,n,theta)=sqrt((2*n+1)*factorial(n-m)/(2*factorial(n+m)))*</span> </span>
<span class="py-lineno">  85</span>  <span class="py-line"><span class="py-docstring">sin(theta)**m/(2**n*factorial(n)) times the (n+m)th derivative of</span> </span>
<span class="py-lineno">  86</span>  <span class="py-line"><span class="py-docstring">(x**2-1)**n with respect to x=cos(theta).</span> </span>
<span class="py-lineno">  87</span>  <span class="py-line"><span class="py-docstring">theta = pi/2 - phi, where phi is latitude and theta is colatitude.</span> </span>
<span class="py-lineno">  88</span>  <span class="py-line"><span class="py-docstring">Therefore, cos(theta) = sin(phi) and sin(theta) = cos(phi).</span> </span>
<span class="py-lineno">  89</span>  <span class="py-line"><span class="py-docstring">Note that pbar(0,0,theta)=sqrt(2)/2, and pbar(1,0,theta)=.5*sqrt(6)*sin(lat).</span> </span>
<span class="py-lineno">  90</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">  91</span>  <span class="py-line"><span class="py-docstring">The default grid type is regular (equally spaced latitude points).  </span> </span>
<span class="py-lineno">  92</span>  <span class="py-line"><span class="py-docstring">Set gridtype='gaussian' when creating a class instance</span> </span>
<span class="py-lineno">  93</span>  <span class="py-line"><span class="py-docstring">for gaussian latitude points.</span> </span>
<span class="py-lineno">  94</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">  95</span>  <span class="py-line"><span class="py-docstring">Quantities needed to compute spherical harmonics are precomputed and stored</span> </span>
<span class="py-lineno">  96</span>  <span class="py-line"><span class="py-docstring">when the class instance is created with legfunc='stored' (the default).</span> </span>
<span class="py-lineno">  97</span>  <span class="py-line"><span class="py-docstring">If legfunc='computed', they are recomputed on the fly on each method call.</span> </span>
<span class="py-lineno">  98</span>  <span class="py-line"><span class="py-docstring">The storage requirements for legfunc="stored" increase like nlat**2, while</span> </span>
<span class="py-lineno">  99</span>  <span class="py-line"><span class="py-docstring">those for legfunc='stored' increase like nlat**3.  However, for</span> </span>
<span class="py-lineno"> 100</span>  <span class="py-line"><span class="py-docstring">repeated method invocations on a single class instance, legfunc="stored"</span> </span>
<span class="py-lineno"> 101</span>  <span class="py-line"><span class="py-docstring">will always be faster.</span> </span>
<span class="py-lineno"> 102</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 103</span>  <span class="py-line"><span class="py-docstring">@contact: U{Jeff Whitaker&lt;mailto:jeffrey.s.whitaker@noaa.gov&gt;}</span> </span>
<span class="py-lineno"> 104</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 105</span>  <span class="py-line"><span class="py-docstring">@version: 1.0      </span> </span>
<span class="py-lineno"> 106</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 107</span>  <span class="py-line"><span class="py-docstring">@license: Permission to use, copy, modify, and distribute this software and its</span> </span>
<span class="py-lineno"> 108</span>  <span class="py-line"><span class="py-docstring">documentation for any purpose and without fee is hereby granted,</span> </span>
<span class="py-lineno"> 109</span>  <span class="py-line"><span class="py-docstring">provided that the above copyright notice appear in all copies and that</span> </span>
<span class="py-lineno"> 110</span>  <span class="py-line"><span class="py-docstring">both that copyright notice and this permission notice appear in</span> </span>
<span class="py-lineno"> 111</span>  <span class="py-line"><span class="py-docstring">supporting documentation.</span> </span>
<span class="py-lineno"> 112</span>  <span class="py-line"><span class="py-docstring">THE AUTHOR DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,</span> </span>
<span class="py-lineno"> 113</span>  <span class="py-line"><span class="py-docstring">INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO</span> </span>
<span class="py-lineno"> 114</span>  <span class="py-line"><span class="py-docstring">EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, INDIRECT OR</span> </span>
<span class="py-lineno"> 115</span>  <span class="py-line"><span class="py-docstring">CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF</span> </span>
<span class="py-lineno"> 116</span>  <span class="py-line"><span class="py-docstring">USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR</span> </span>
<span class="py-lineno"> 117</span>  <span class="py-line"><span class="py-docstring">OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR</span> </span>
<span class="py-lineno"> 118</span>  <span class="py-line"><span class="py-docstring">PERFORMANCE OF THIS SOFTWARE.</span> </span>
<span class="py-lineno"> 119</span>  <span class="py-line"><span class="py-docstring">"""</span> </span>
<span class="py-lineno"> 120</span>  <span class="py-line"><span class="py-keyword">import</span> <span class="py-name">_spherepack</span><span class="py-op">,</span> <span class="py-name">numpy</span><span class="py-op">,</span> <span class="py-name">math</span><span class="py-op">,</span> <span class="py-name">sys</span> </span>
<span class="py-lineno"> 121</span>  <span class="py-line"> </span>
<span class="py-lineno"> 122</span>  <span class="py-line"><span class="py-comment"># define a list of instance variables that cannot be rebound</span> </span>
<span class="py-lineno"> 123</span>  <span class="py-line"><span class="py-comment"></span><span class="py-comment"># or unbound.</span> </span>
<span class="py-lineno"> 124</span>  <span class="py-line"><span class="py-comment"></span><span id="link-0" class="py-name"><a title="spharm.spharm._private_vars" class="py-name" href="#" onclick="doclink('link-0', '_private_vars', 'Variable spharm.spharm._private_vars=spharm.spharm-module.html#_private_vars'); return false;">_private_vars</a></span></span> <span class="py-op">=</span> <span class="py-op">[</span><span class="py-string">'nlon'</span><span class="py-op">,</span><span class="py-string">'nlat'</span><span class="py-op">,</span><span class="py-string">'gridtype'</span><span class="py-op">,</span><span class="py-string">'legfunc'</span><span class="py-op">,</span><span class="py-string">'rsphere'</span><span class="py-op">]</span> </span>
<span class="py-lineno"> 125</span>  <span class="py-line"><span id="link-1" class="py-name"><a title="spharm.spharm.__version__" class="py-name" href="#" onclick="doclink('link-1', '__version__', 'Variable spharm.spharm.__version__=spharm.spharm-module.html#__version__'); return false;">__version__</a></span></span> <span class="py-op">=</span> <span class="py-number">1.0</span> </span>
<span class="py-lineno"> 126</span>  <span class="py-line"> </span>
<a name="Spharmt"></a><div id="Spharmt-def"><span class="py-lineno"> 127</span> <a class="py-toggle" href="#" id="Spharmt-toggle" onclick="toggle('Spharmt'); return false;">-</a><span class="py-line"><span class="py-keyword">class</span> <a class="py-def-name" href="spharm.spharm.Spharmt-class.html">Spharmt</a><span class="py-op">:</span> </span>
</div><div id="Spharmt-collapsed" style="display:none;" pad="++++" indent="++++"></div><div id="Spharmt-expanded"><span class="py-lineno"> 128</span>  <span class="py-line">    <span class="py-docstring">"""</span> </span>
<span class="py-lineno"> 129</span>  <span class="py-line"><span class="py-docstring"> spherical harmonic transform class.</span> </span>
<span class="py-lineno"> 130</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 131</span>  <span class="py-line"><span class="py-docstring"> @ivar nlat: number of latitudes (set when class instance is created,</span> </span>
<span class="py-lineno"> 132</span>  <span class="py-line"><span class="py-docstring"> cannot be changed).</span> </span>
<span class="py-lineno"> 133</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 134</span>  <span class="py-line"><span class="py-docstring"> @ivar nlon: number of longitudes (set when class instance is created,</span> </span>
<span class="py-lineno"> 135</span>  <span class="py-line"><span class="py-docstring"> cannot be changed).</span> </span>
<span class="py-lineno"> 136</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 137</span>  <span class="py-line"><span class="py-docstring"> @ivar rsphere: The radius of the sphere in meters (set when class</span> </span>
<span class="py-lineno"> 138</span>  <span class="py-line"><span class="py-docstring"> instance is created, cannot be changed).</span> </span>
<span class="py-lineno"> 139</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 140</span>  <span class="py-line"><span class="py-docstring"> @ivar legfunc: 'stored' or 'computed'.  If 'stored', </span> </span>
<span class="py-lineno"> 141</span>  <span class="py-line"><span class="py-docstring"> associated legendre functions are precomputed and stored when the</span> </span>
<span class="py-lineno"> 142</span>  <span class="py-line"><span class="py-docstring"> class instance is created.  If 'computed', associated </span> </span>
<span class="py-lineno"> 143</span>  <span class="py-line"><span class="py-docstring"> legendre functions are computed on the fly when transforms are</span> </span>
<span class="py-lineno"> 144</span>  <span class="py-line"><span class="py-docstring"> requested. Set when class instance is created, cannot be changed.</span> </span>
<span class="py-lineno"> 145</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 146</span>  <span class="py-line"><span class="py-docstring"> @ivar gridtype: 'regular' (equally spaced in longitude and latitude)</span> </span>
<span class="py-lineno"> 147</span>  <span class="py-line"><span class="py-docstring"> or 'gaussian' (equally spaced in longitude, latitudes located at</span> </span>
<span class="py-lineno"> 148</span>  <span class="py-line"><span class="py-docstring"> roots of ordinary Legendre polynomial of degree nlat). Set when class</span> </span>
<span class="py-lineno"> 149</span>  <span class="py-line"><span class="py-docstring"> instance is created, cannot be changed.</span> </span>
<span class="py-lineno"> 150</span>  <span class="py-line"><span class="py-docstring">    """</span> </span>
<span class="py-lineno"> 151</span>  <span class="py-line"> </span>
<a name="Spharmt.__setattr__"></a><div id="Spharmt.__setattr__-def"><span class="py-lineno"> 152</span> <a class="py-toggle" href="#" id="Spharmt.__setattr__-toggle" onclick="toggle('Spharmt.__setattr__'); return false;">-</a><span class="py-line">    <span class="py-keyword">def</span> <a class="py-def-name" href="spharm.spharm.Spharmt-class.html#__setattr__">__setattr__</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">key</span><span class="py-op">,</span> <span class="py-param">val</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Spharmt.__setattr__-collapsed" style="display:none;" pad="++++" indent="++++++++"></div><div id="Spharmt.__setattr__-expanded"><span class="py-lineno"> 153</span>  <span class="py-line">        <span class="py-docstring">"""</span> </span>
<span class="py-lineno"> 154</span>  <span class="py-line"><span class="py-docstring">prevent modification of read-only instance variables.</span> </span>
<span class="py-lineno"> 155</span>  <span class="py-line"><span class="py-docstring">        """</span> </span>
<span class="py-lineno"> 156</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">__dict__</span><span class="py-op">.</span><span class="py-name">has_key</span><span class="py-op">(</span><span class="py-name">key</span><span class="py-op">)</span> <span class="py-keyword">and</span> <span class="py-name">key</span> <span class="py-keyword">in</span> <span id="link-2" class="py-name"><a title="spharm.spharm._private_vars" class="py-name" href="#" onclick="doclink('link-2', '_private_vars', 'Variable spharm.spharm._private_vars=spharm.spharm-module.html#_private_vars'); return false;">_private_vars</a></span></span><span class="py-op">:</span> </span>
<span class="py-lineno"> 157</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">AttributeError</span><span class="py-op">,</span> <span class="py-string">'Attempt to rebind read-only instance variable '</span><span class="py-op">+</span><span class="py-name">key</span> </span>
<span class="py-lineno"> 158</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 159</span>  <span class="py-line">            <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">__dict__</span><span class="py-op">[</span><span class="py-name">key</span><span class="py-op">]</span> <span class="py-op">=</span> <span class="py-name">val</span> </span>
</div><span class="py-lineno"> 160</span>  <span class="py-line"> </span>
<a name="Spharmt.__delattr__"></a><div id="Spharmt.__delattr__-def"><span class="py-lineno"> 161</span> <a class="py-toggle" href="#" id="Spharmt.__delattr__-toggle" onclick="toggle('Spharmt.__delattr__'); return false;">-</a><span class="py-line">    <span class="py-keyword">def</span> <a class="py-def-name" href="spharm.spharm.Spharmt-class.html#__delattr__">__delattr__</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">key</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Spharmt.__delattr__-collapsed" style="display:none;" pad="++++" indent="++++++++"></div><div id="Spharmt.__delattr__-expanded"><span class="py-lineno"> 162</span>  <span class="py-line">        <span class="py-docstring">"""</span> </span>
<span class="py-lineno"> 163</span>  <span class="py-line"><span class="py-docstring">prevent deletion of read-only instance variables.</span> </span>
<span class="py-lineno"> 164</span>  <span class="py-line"><span class="py-docstring">        """</span> </span>
<span class="py-lineno"> 165</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">__dict__</span><span class="py-op">.</span><span class="py-name">has_key</span><span class="py-op">(</span><span class="py-name">key</span><span class="py-op">)</span> <span class="py-keyword">and</span> <span class="py-name">key</span> <span class="py-keyword">in</span> <span id="link-3" class="py-name"><a title="spharm.spharm._private_vars" class="py-name" href="#" onclick="doclink('link-3', '_private_vars', 'Variable spharm.spharm._private_vars=spharm.spharm-module.html#_private_vars'); return false;">_private_vars</a></span></span><span class="py-op">:</span> </span>
<span class="py-lineno"> 166</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">AttributeError</span><span class="py-op">,</span> <span class="py-string">'Attempt to unbind read-only instance variable '</span><span class="py-op">+</span><span class="py-name">key</span> </span>
<span class="py-lineno"> 167</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 168</span>  <span class="py-line">            <span class="py-keyword">del</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">__dict__</span><span class="py-op">[</span><span class="py-name">key</span><span class="py-op">]</span> </span>
</div><span class="py-lineno"> 169</span>  <span class="py-line"> </span>
<a name="Spharmt.__init__"></a><div id="Spharmt.__init__-def"><span class="py-lineno"> 170</span> <a class="py-toggle" href="#" id="Spharmt.__init__-toggle" onclick="toggle('Spharmt.__init__'); return false;">-</a><span class="py-line">    <span class="py-keyword">def</span> <a class="py-def-name" href="spharm.spharm.Spharmt-class.html#__init__">__init__</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">nlon</span><span class="py-op">,</span> <span class="py-param">nlat</span><span class="py-op">,</span> <span class="py-param">rsphere</span><span class="py-op">=</span><span class="py-number">6.3712e6</span><span class="py-op">,</span> <span class="py-param">gridtype</span><span class="py-op">=</span><span class="py-string">'regular'</span><span class="py-op">,</span> <span class="py-param">legfunc</span><span class="py-op">=</span><span class="py-string">'stored'</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Spharmt.__init__-collapsed" style="display:none;" pad="++++" indent="++++++++"></div><div id="Spharmt.__init__-expanded"><span class="py-lineno"> 171</span>  <span class="py-line">        <span class="py-docstring">"""</span> </span>
<span class="py-lineno"> 172</span>  <span class="py-line"><span class="py-docstring"> create a Spharmt class instance.</span> </span>
<span class="py-lineno"> 173</span>  <span class="py-line"><span class="py-docstring">    </span> </span>
<span class="py-lineno"> 174</span>  <span class="py-line"><span class="py-docstring"> @param nlon: Number of longitudes. The grid must be oriented from</span> </span>
<span class="py-lineno"> 175</span>  <span class="py-line"><span class="py-docstring"> east to west, with the first point at the Greenwich meridian</span> </span>
<span class="py-lineno"> 176</span>  <span class="py-line"><span class="py-docstring"> and the last point at 360-delta degrees east</span> </span>
<span class="py-lineno"> 177</span>  <span class="py-line"><span class="py-docstring"> (where delta = 360/nlon degrees). Must be &gt;= 4. Transforms will</span> </span>
<span class="py-lineno"> 178</span>  <span class="py-line"><span class="py-docstring"> be faster when nlon is the product of small primes.</span> </span>
<span class="py-lineno"> 179</span>  <span class="py-line"><span class="py-docstring">            </span> </span>
<span class="py-lineno"> 180</span>  <span class="py-line"><span class="py-docstring"> @param nlat: Number of latitudes.  The grid must be oriented from north</span> </span>
<span class="py-lineno"> 181</span>  <span class="py-line"><span class="py-docstring"> to south. If nlat is odd the equator is included.</span> </span>
<span class="py-lineno"> 182</span>  <span class="py-line"><span class="py-docstring"> If nlat is even the equator will lie half way between points</span> </span>
<span class="py-lineno"> 183</span>  <span class="py-line"><span class="py-docstring"> points nlat/2 and (nlat/2)+1. Must be &gt;=3.</span> </span>
<span class="py-lineno"> 184</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 185</span>  <span class="py-line"><span class="py-docstring"> @keyword rsphere: The radius of the sphere in meters.  </span> </span>
<span class="py-lineno"> 186</span>  <span class="py-line"><span class="py-docstring"> Default 6371200 (the value for Earth).</span> </span>
<span class="py-lineno"> 187</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 188</span>  <span class="py-line"><span class="py-docstring"> @keyword legfunc: 'stored' (default) or 'computed'.  If 'stored', </span> </span>
<span class="py-lineno"> 189</span>  <span class="py-line"><span class="py-docstring"> associated legendre functions are precomputed and stored when the</span> </span>
<span class="py-lineno"> 190</span>  <span class="py-line"><span class="py-docstring"> class instance is created.  This uses O(nlat**3) memory, but</span> </span>
<span class="py-lineno"> 191</span>  <span class="py-line"><span class="py-docstring"> speeds up the spectral transforms.  If 'computed', associated </span> </span>
<span class="py-lineno"> 192</span>  <span class="py-line"><span class="py-docstring"> legendre functions are computed on the fly when transforms are</span> </span>
<span class="py-lineno"> 193</span>  <span class="py-line"><span class="py-docstring"> requested.  This uses O(nlat**2) memory, but slows down the spectral</span> </span>
<span class="py-lineno"> 194</span>  <span class="py-line"><span class="py-docstring"> transforms a bit.</span> </span>
<span class="py-lineno"> 195</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 196</span>  <span class="py-line"><span class="py-docstring"> @keyword gridtype: 'regular' (default) or 'gaussian'. Regular grids</span> </span>
<span class="py-lineno"> 197</span>  <span class="py-line"><span class="py-docstring"> will include the poles and equator if nlat is odd.  Gaussian</span> </span>
<span class="py-lineno"> 198</span>  <span class="py-line"><span class="py-docstring"> grids never include the poles, but will include the equator if</span> </span>
<span class="py-lineno"> 199</span>  <span class="py-line"><span class="py-docstring"> nlat is odd.</span> </span>
<span class="py-lineno"> 200</span>  <span class="py-line"><span class="py-docstring">   </span> </span>
<span class="py-lineno"> 201</span>  <span class="py-line"><span class="py-docstring">        """</span> </span>
<span class="py-lineno"> 202</span>  <span class="py-line"><span class="py-comment"># sanity checks.</span> </span>
<span class="py-lineno"> 203</span>  <span class="py-line"><span class="py-comment"></span>        <span class="py-keyword">if</span> <span class="py-name">rsphere</span> <span class="py-op">&gt;</span> <span class="py-number">0.0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 204</span>  <span class="py-line">            <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">rsphere</span><span class="py-op">=</span> <span class="py-name">rsphere</span> </span>
<span class="py-lineno"> 205</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 206</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'Spharmt.__init__ illegal value of rsphere (%s) - must be postitive'</span> <span class="py-op">%</span> <span class="py-op">(</span><span class="py-name">rsphere</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 207</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 208</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">nlon</span> <span class="py-op">&gt;</span> <span class="py-number">3</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 209</span>  <span class="py-line">            <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlon</span> <span class="py-op">=</span> <span class="py-name">nlon</span> </span>
<span class="py-lineno"> 210</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 211</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'Spharmt.__init__ illegal value of nlon (%s) - must be at least 4'</span> <span class="py-op">%</span> <span class="py-op">(</span><span class="py-name">nlon</span><span class="py-op">,</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 212</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 213</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">nlat</span> <span class="py-op">&gt;</span> <span class="py-number">2</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 214</span>  <span class="py-line">            <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlat</span> <span class="py-op">=</span> <span class="py-name">nlat</span> </span>
<span class="py-lineno"> 215</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 216</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'Spharmt.__init__ illegal value of nlat (%s) - must be at least 3'</span> <span class="py-op">%</span> <span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 217</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 218</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">gridtype</span> <span class="py-op">!=</span> <span class="py-string">'regular'</span> <span class="py-keyword">and</span> <span class="py-name">gridtype</span> <span class="py-op">!=</span> <span class="py-string">'gaussian'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 219</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'Spharmt.__init__ illegal value of gridtype (%s) - must be either "gaussian" or "regular"'</span> <span class="py-op">%</span> <span class="py-name">gridtype</span> </span>
<span class="py-lineno"> 220</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 221</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 222</span>  <span class="py-line">            <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">gridtype</span> <span class="py-op">=</span> <span class="py-name">gridtype</span> </span>
<span class="py-lineno"> 223</span>  <span class="py-line"> </span>
<span class="py-lineno"> 224</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">legfunc</span> <span class="py-op">!=</span> <span class="py-string">'computed'</span> <span class="py-keyword">and</span> <span class="py-name">legfunc</span> <span class="py-op">!=</span> <span class="py-string">'stored'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 225</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'Spharmt.__init__ illegal value of legfunc (%s) - must be either "computed" or "stored"'</span> <span class="py-op">%</span> <span class="py-name">legfunc</span> </span>
<span class="py-lineno"> 226</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 227</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 228</span>  <span class="py-line">            <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">legfunc</span> <span class="py-op">=</span> <span class="py-name">legfunc</span> </span>
<span class="py-lineno"> 229</span>  <span class="py-line"> </span>
<span class="py-lineno"> 230</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">nlon</span><span class="py-op">%</span><span class="py-number">2</span><span class="py-op">:</span>                              <span class="py-comment"># nlon is odd</span> </span>
<span class="py-lineno"> 231</span>  <span class="py-line">            <span class="py-name">n1</span> <span class="py-op">=</span> <span class="py-name">min</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-op">(</span><span class="py-name">nlon</span> <span class="py-op">+</span> <span class="py-number">1</span><span class="py-op">)</span><span class="py-op">/</span><span class="py-number">2</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 232</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 233</span>  <span class="py-line">            <span class="py-name">n1</span> <span class="py-op">=</span> <span class="py-name">min</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-op">(</span><span class="py-name">nlon</span> <span class="py-op">+</span> <span class="py-number">2</span><span class="py-op">)</span><span class="py-op">/</span><span class="py-number">2</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 234</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">nlat</span><span class="py-op">%</span><span class="py-number">2</span><span class="py-op">:</span>                              <span class="py-comment"># nlat is odd</span> </span>
<span class="py-lineno"> 235</span>  <span class="py-line">            <span class="py-name">n2</span> <span class="py-op">=</span> <span class="py-op">(</span><span class="py-name">nlat</span> <span class="py-op">+</span> <span class="py-number">1</span><span class="py-op">)</span><span class="py-op">/</span><span class="py-number">2</span> </span>
<span class="py-lineno"> 236</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 237</span>  <span class="py-line">            <span class="py-name">n2</span> <span class="py-op">=</span> <span class="py-name">nlat</span><span class="py-op">/</span><span class="py-number">2</span> </span>
<span class="py-lineno"> 238</span>  <span class="py-line"> </span>
<span class="py-lineno"> 239</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">gridtype</span> <span class="py-op">==</span> <span class="py-string">'regular'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 240</span>  <span class="py-line">            <span class="py-keyword">if</span> <span class="py-name">legfunc</span> <span class="py-op">==</span> <span class="py-string">'stored'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 241</span>  <span class="py-line">                <span class="py-name">lshaes</span> <span class="py-op">=</span> <span class="py-op">(</span><span class="py-name">n1</span><span class="py-op">*</span><span class="py-name">n2</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span> <span class="py-op">+</span> <span class="py-name">nlat</span> <span class="py-op">-</span> <span class="py-name">n1</span> <span class="py-op">+</span> <span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span><span class="py-op">/</span><span class="py-number">2</span> <span class="py-op">+</span> <span class="py-name">nlon</span> <span class="py-op">+</span> <span class="py-number">15</span> </span>
<span class="py-lineno"> 242</span>  <span class="py-line">                <span class="py-name">lwork</span> <span class="py-op">=</span> <span class="py-number">5</span><span class="py-op">*</span><span class="py-name">nlat</span><span class="py-op">*</span><span class="py-name">n2</span> <span class="py-op">+</span> <span class="py-number">3</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-op">(</span><span class="py-name">n1</span> <span class="py-op">-</span> <span class="py-number">2</span><span class="py-op">)</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span> <span class="py-op">+</span> <span class="py-name">nlat</span> <span class="py-op">-</span> <span class="py-name">n1</span> <span class="py-op">-</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span><span class="py-op">/</span><span class="py-number">2</span>  </span>
<span class="py-lineno"> 243</span>  <span class="py-line">                <span class="py-name">wshaes</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">shaesi</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-name">nlon</span><span class="py-op">,</span> <span class="py-name">lshaes</span><span class="py-op">,</span> <span class="py-name">lwork</span><span class="py-op">,</span> <span class="py-name">nlat</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 244</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 245</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to shaesi in Spharmt.__init__ ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 246</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 247</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wshaes</span> <span class="py-op">=</span> <span class="py-name">wshaes</span> </span>
<span class="py-lineno"> 248</span>  <span class="py-line">                <span class="py-name">lshses</span> <span class="py-op">=</span> <span class="py-name">lshaes</span> </span>
<span class="py-lineno"> 249</span>  <span class="py-line">                <span class="py-name">wshses</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">shsesi</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-name">nlon</span><span class="py-op">,</span> <span class="py-name">lshses</span><span class="py-op">,</span> <span class="py-name">lwork</span><span class="py-op">,</span> <span class="py-name">nlat</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 250</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 251</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to shsesi in Spharmt.__init__ ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 252</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 253</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wshses</span> <span class="py-op">=</span> <span class="py-name">wshses</span> </span>
<span class="py-lineno"> 254</span>  <span class="py-line">                <span class="py-name">lvhaes</span> <span class="py-op">=</span> <span class="py-name">n1</span><span class="py-op">*</span><span class="py-name">n2</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span> <span class="py-op">+</span> <span class="py-name">nlat</span> <span class="py-op">-</span> <span class="py-name">n1</span> <span class="py-op">+</span> <span class="py-number">1</span><span class="py-op">)</span> <span class="py-op">+</span> <span class="py-name">nlon</span> <span class="py-op">+</span> <span class="py-number">15</span> </span>
<span class="py-lineno"> 255</span>  <span class="py-line">                <span class="py-name">lwork</span> <span class="py-op">=</span> <span class="py-number">3</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">max</span><span class="py-op">(</span><span class="py-name">n1</span> <span class="py-op">-</span><span class="py-number">2</span><span class="py-op">,</span><span class="py-number">0</span><span class="py-op">)</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span> <span class="py-op">+</span> <span class="py-name">nlat</span> <span class="py-op">-</span> <span class="py-name">n1</span> <span class="py-op">-</span> <span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span><span class="py-op">/</span><span class="py-number">2</span> <span class="py-op">+</span> <span class="py-number">5</span><span class="py-op">*</span><span class="py-name">n2</span><span class="py-op">*</span><span class="py-name">nlat</span> </span>
<span class="py-lineno"> 256</span>  <span class="py-line">                <span class="py-name">wvhaes</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">vhaesi</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-name">nlon</span><span class="py-op">,</span> <span class="py-name">lvhaes</span><span class="py-op">,</span> <span class="py-name">lwork</span><span class="py-op">,</span> <span class="py-number">2</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 257</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 258</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to vhaesi in Spharmt.__init__ ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 259</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 260</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wvhaes</span> <span class="py-op">=</span> <span class="py-name">wvhaes</span> </span>
<span class="py-lineno"> 261</span>  <span class="py-line">                <span class="py-name">lwork</span> <span class="py-op">=</span> <span class="py-number">3</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">max</span><span class="py-op">(</span><span class="py-name">n1</span> <span class="py-op">-</span> <span class="py-number">2</span><span class="py-op">,</span><span class="py-number">0</span><span class="py-op">)</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span> <span class="py-op">+</span> <span class="py-name">nlat</span> <span class="py-op">-</span> <span class="py-name">n1</span> <span class="py-op">-</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span><span class="py-op">/</span><span class="py-number">2</span> <span class="py-op">+</span> <span class="py-number">5</span><span class="py-op">*</span><span class="py-name">n2</span><span class="py-op">*</span><span class="py-name">nlat</span> </span>
<span class="py-lineno"> 262</span>  <span class="py-line">                <span class="py-name">lvhses</span> <span class="py-op">=</span> <span class="py-name">n1</span><span class="py-op">*</span><span class="py-name">n2</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span> <span class="py-op">+</span> <span class="py-name">nlat</span> <span class="py-op">-</span> <span class="py-name">n1</span> <span class="py-op">+</span> <span class="py-number">1</span><span class="py-op">)</span> <span class="py-op">+</span> <span class="py-name">nlon</span> <span class="py-op">+</span> <span class="py-number">15</span> </span>
<span class="py-lineno"> 263</span>  <span class="py-line">                <span class="py-name">wvhses</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">vhsesi</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span><span class="py-name">nlon</span><span class="py-op">,</span><span class="py-name">lvhses</span><span class="py-op">,</span><span class="py-name">lwork</span><span class="py-op">,</span><span class="py-number">2</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 264</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 265</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to vhsesi in Spharmt.__init__ ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 266</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 267</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wvhses</span> <span class="py-op">=</span> <span class="py-name">wvhses</span> </span>
<span class="py-lineno"> 268</span>  <span class="py-line">            <span class="py-keyword">else</span><span class="py-op">:</span>  </span>
<span class="py-lineno"> 269</span>  <span class="py-line">                <span class="py-name">lshaec</span> <span class="py-op">=</span> <span class="py-number">2</span><span class="py-op">*</span><span class="py-name">nlat</span><span class="py-op">*</span><span class="py-name">n2</span><span class="py-op">+</span><span class="py-number">3</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-op">(</span><span class="py-name">n1</span><span class="py-op">-</span><span class="py-number">2</span><span class="py-op">)</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">+</span><span class="py-name">nlat</span><span class="py-op">-</span><span class="py-name">n1</span><span class="py-op">-</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span><span class="py-op">/</span><span class="py-number">2</span><span class="py-op">+</span><span class="py-name">nlon</span><span class="py-op">+</span><span class="py-number">15</span> </span>
<span class="py-lineno"> 270</span>  <span class="py-line">                <span class="py-name">wshaec</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">shaeci</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-name">nlon</span><span class="py-op">,</span> <span class="py-name">lshaec</span><span class="py-op">,</span> <span class="py-number">2</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 271</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 272</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to shaeci in Spharmt.__init__ ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 273</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 274</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wshaec</span> <span class="py-op">=</span> <span class="py-name">wshaec</span>                </span>
<span class="py-lineno"> 275</span>  <span class="py-line">                <span class="py-name">lshsec</span> <span class="py-op">=</span> <span class="py-name">lshaec</span> </span>
<span class="py-lineno"> 276</span>  <span class="py-line">                <span class="py-name">wshsec</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">shseci</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-name">nlon</span><span class="py-op">,</span> <span class="py-name">lshsec</span><span class="py-op">,</span> <span class="py-number">2</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 277</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 278</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to shseci in Spharmt.__init__ ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 279</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 280</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wshsec</span> <span class="py-op">=</span> <span class="py-name">wshsec</span> </span>
<span class="py-lineno"> 281</span>  <span class="py-line">                <span class="py-name">lvhaec</span> <span class="py-op">=</span> <span class="py-number">4</span><span class="py-op">*</span><span class="py-name">nlat</span><span class="py-op">*</span><span class="py-name">n2</span><span class="py-op">+</span><span class="py-number">3</span><span class="py-op">*</span><span class="py-name">max</span><span class="py-op">(</span><span class="py-name">n1</span><span class="py-op">-</span><span class="py-number">2</span><span class="py-op">,</span><span class="py-number">0</span><span class="py-op">)</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-number">2</span><span class="py-op">*</span><span class="py-name">nlat</span><span class="py-op">-</span><span class="py-name">n1</span><span class="py-op">-</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">+</span><span class="py-name">nlon</span><span class="py-op">+</span><span class="py-number">15</span> </span>
<span class="py-lineno"> 282</span>  <span class="py-line">                <span class="py-name">wvhaec</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">vhaeci</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-name">nlon</span><span class="py-op">,</span> <span class="py-name">lvhaec</span><span class="py-op">,</span>  <span class="py-number">2</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 283</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 284</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to vhaeci in Spharmt.__init__ ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 285</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 286</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wvhaec</span> <span class="py-op">=</span> <span class="py-name">wvhaec</span> </span>
<span class="py-lineno"> 287</span>  <span class="py-line">                <span class="py-name">lvhsec</span> <span class="py-op">=</span> <span class="py-name">lvhaec</span> </span>
<span class="py-lineno"> 288</span>  <span class="py-line">                <span class="py-name">wvhsec</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">vhseci</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-name">nlon</span><span class="py-op">,</span> <span class="py-name">lvhsec</span><span class="py-op">,</span>  <span class="py-number">2</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 289</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 290</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to vhseci in Spharmt.__init__ ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 291</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 292</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wvhsec</span> <span class="py-op">=</span> <span class="py-name">wvhsec</span> </span>
<span class="py-lineno"> 293</span>  <span class="py-line">                 </span>
<span class="py-lineno"> 294</span>  <span class="py-line">                  </span>
<span class="py-lineno"> 295</span>  <span class="py-line">        <span class="py-keyword">elif</span> <span class="py-name">gridtype</span> <span class="py-op">==</span> <span class="py-string">'gaussian'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 296</span>  <span class="py-line">            <span class="py-keyword">if</span> <span class="py-name">legfunc</span> <span class="py-op">==</span> <span class="py-string">'stored'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 297</span>  <span class="py-line">                <span class="py-name">lshags</span> <span class="py-op">=</span> <span class="py-name">nlat</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-number">3</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">n1</span> <span class="py-op">+</span> <span class="py-name">n2</span><span class="py-op">)</span> <span class="py-op">-</span> <span class="py-number">2</span><span class="py-op">)</span> <span class="py-op">+</span> <span class="py-op">(</span><span class="py-name">n1</span> <span class="py-op">-</span> <span class="py-number">1</span><span class="py-op">)</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">n2</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-number">2</span><span class="py-op">*</span><span class="py-name">nlat</span> <span class="py-op">-</span> <span class="py-name">n1</span><span class="py-op">)</span> <span class="py-op">-</span> <span class="py-number">3</span><span class="py-op">*</span><span class="py-name">n1</span><span class="py-op">)</span><span class="py-op">/</span><span class="py-number">2</span> <span class="py-op">+</span> <span class="py-name">nlon</span> <span class="py-op">+</span> <span class="py-number">15</span> </span>
<span class="py-lineno"> 298</span>  <span class="py-line">                <span class="py-name">lwork</span> <span class="py-op">=</span> <span class="py-number">4</span><span class="py-op">*</span><span class="py-name">nlat</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span> <span class="py-op">+</span> <span class="py-number">2</span><span class="py-op">)</span> <span class="py-op">+</span> <span class="py-number">2</span> </span>
<span class="py-lineno"> 299</span>  <span class="py-line">                <span class="py-name">ldwork</span> <span class="py-op">=</span> <span class="py-name">nlat</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span> <span class="py-op">+</span> <span class="py-number">4</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 300</span>  <span class="py-line">                <span class="py-name">wshags</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">shagsi</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-name">nlon</span><span class="py-op">,</span> <span class="py-name">lshags</span><span class="py-op">,</span> <span class="py-name">lwork</span><span class="py-op">,</span> <span class="py-name">ldwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 301</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 302</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to shagsi in Spharmt.__init__ ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 303</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 304</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wshags</span> <span class="py-op">=</span> <span class="py-name">wshags</span> </span>
<span class="py-lineno"> 305</span>  <span class="py-line">                <span class="py-name">lshsgs</span> <span class="py-op">=</span> <span class="py-name">lshags</span> </span>
<span class="py-lineno"> 306</span>  <span class="py-line">                <span class="py-name">wshsgs</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">shsgsi</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-name">nlon</span><span class="py-op">,</span> <span class="py-name">lshsgs</span><span class="py-op">,</span> <span class="py-name">lwork</span><span class="py-op">,</span> <span class="py-name">ldwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 307</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 308</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to shsgsi in Spharmt.__init__ ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 309</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 310</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wshsgs</span> <span class="py-op">=</span> <span class="py-name">wshsgs</span> </span>
<span class="py-lineno"> 311</span>  <span class="py-line">                <span class="py-name">lvhags</span> <span class="py-op">=</span> <span class="py-op">(</span><span class="py-name">nlat</span> <span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span> <span class="py-op">+</span> <span class="py-number">1</span><span class="py-op">)</span><span class="py-op">*</span><span class="py-name">nlat</span><span class="py-op">/</span><span class="py-number">2</span> <span class="py-op">+</span><span class="py-name">nlon</span> <span class="py-op">+</span> <span class="py-number">15</span> </span>
<span class="py-lineno"> 312</span>  <span class="py-line">                <span class="py-name">ldwork</span> <span class="py-op">=</span> <span class="py-op">(</span><span class="py-number">3</span><span class="py-op">*</span><span class="py-name">nlat</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span> <span class="py-op">+</span> <span class="py-number">3</span><span class="py-op">)</span> <span class="py-op">+</span> <span class="py-number">2</span><span class="py-op">)</span><span class="py-op">/</span><span class="py-number">2</span> </span>
<span class="py-lineno"> 313</span>  <span class="py-line">                <span class="py-name">wvhags</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">vhagsi</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-name">nlon</span><span class="py-op">,</span> <span class="py-name">lvhags</span><span class="py-op">,</span> <span class="py-name">ldwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 314</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 315</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to vhagsi in Spharmt.__init__ ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 316</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 317</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wvhags</span> <span class="py-op">=</span> <span class="py-name">wvhags</span> </span>
<span class="py-lineno"> 318</span>  <span class="py-line">                <span class="py-name">lvhsgs</span> <span class="py-op">=</span> <span class="py-name">n1</span><span class="py-op">*</span><span class="py-name">n2</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span> <span class="py-op">+</span> <span class="py-name">nlat</span> <span class="py-op">-</span> <span class="py-name">n1</span> <span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span> <span class="py-op">+</span> <span class="py-name">nlon</span> <span class="py-op">+</span> <span class="py-number">15</span> <span class="py-op">+</span> <span class="py-number">2</span><span class="py-op">*</span><span class="py-name">nlat</span> </span>
<span class="py-lineno"> 319</span>  <span class="py-line">                <span class="py-name">ldwork</span> <span class="py-op">=</span> <span class="py-op">(</span><span class="py-number">3</span><span class="py-op">*</span><span class="py-name">nlat</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span> <span class="py-op">+</span> <span class="py-number">3</span><span class="py-op">)</span> <span class="py-op">+</span> <span class="py-number">2</span><span class="py-op">)</span><span class="py-op">/</span><span class="py-number">2</span>  </span>
<span class="py-lineno"> 320</span>  <span class="py-line">                <span class="py-name">wvhsgs</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">vhsgsi</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-name">nlon</span><span class="py-op">,</span> <span class="py-name">lvhsgs</span><span class="py-op">,</span> <span class="py-name">ldwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 321</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 322</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to vhsgsi in Spharmt.__init__ ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 323</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 324</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wvhsgs</span> <span class="py-op">=</span> <span class="py-name">wvhsgs</span> </span>
<span class="py-lineno"> 325</span>  <span class="py-line">            <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 326</span>  <span class="py-line">                <span class="py-name">lshagc</span> <span class="py-op">=</span> <span class="py-name">nlat</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-number">2</span><span class="py-op">*</span><span class="py-name">n2</span><span class="py-op">+</span><span class="py-number">3</span><span class="py-op">*</span><span class="py-name">n1</span><span class="py-op">-</span><span class="py-number">2</span><span class="py-op">)</span><span class="py-op">+</span><span class="py-number">3</span><span class="py-op">*</span><span class="py-name">n1</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-number">1</span><span class="py-op">-</span><span class="py-name">n1</span><span class="py-op">)</span><span class="py-op">/</span><span class="py-number">2</span><span class="py-op">+</span><span class="py-name">nlon</span><span class="py-op">+</span><span class="py-number">15</span> </span>
<span class="py-lineno"> 327</span>  <span class="py-line">                <span class="py-name">wshagc</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">shagci</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-name">nlon</span><span class="py-op">,</span> <span class="py-name">lshagc</span><span class="py-op">,</span> <span class="py-name">nlat</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">+</span><span class="py-number">4</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 328</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 329</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to shagci in Spharmt.__init__ ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 330</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 331</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wshagc</span> <span class="py-op">=</span> <span class="py-name">wshagc</span> </span>
<span class="py-lineno"> 332</span>  <span class="py-line">                <span class="py-name">lshsgc</span> <span class="py-op">=</span> <span class="py-name">lshagc</span> </span>
<span class="py-lineno"> 333</span>  <span class="py-line">                <span class="py-name">wshsgc</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">shsgci</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-name">nlon</span><span class="py-op">,</span> <span class="py-name">lshsgc</span><span class="py-op">,</span> <span class="py-name">nlat</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">+</span><span class="py-number">4</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 334</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 335</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to shsgci in Spharmt.__init__ ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 336</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 337</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wshsgc</span> <span class="py-op">=</span> <span class="py-name">wshsgc</span> </span>
<span class="py-lineno"> 338</span>  <span class="py-line">                <span class="py-name">lvhagc</span> <span class="py-op">=</span> <span class="py-number">4</span><span class="py-op">*</span><span class="py-name">nlat</span><span class="py-op">*</span><span class="py-name">n2</span><span class="py-op">+</span><span class="py-number">3</span><span class="py-op">*</span><span class="py-name">max</span><span class="py-op">(</span><span class="py-name">n1</span><span class="py-op">-</span><span class="py-number">2</span><span class="py-op">,</span><span class="py-number">0</span><span class="py-op">)</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-number">2</span><span class="py-op">*</span><span class="py-name">nlat</span><span class="py-op">-</span><span class="py-name">n1</span><span class="py-op">-</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">+</span><span class="py-name">nlon</span><span class="py-op">+</span><span class="py-name">n2</span><span class="py-op">+</span><span class="py-number">15</span> </span>
<span class="py-lineno"> 339</span>  <span class="py-line">                <span class="py-name">ldwork</span> <span class="py-op">=</span> <span class="py-number">2</span><span class="py-op">*</span><span class="py-name">nlat</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">+</span><span class="py-number">1</span> </span>
<span class="py-lineno"> 340</span>  <span class="py-line">                <span class="py-name">wvhagc</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">vhagci</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-name">nlon</span><span class="py-op">,</span> <span class="py-name">lvhagc</span><span class="py-op">,</span> <span class="py-name">ldwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 341</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 342</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to vhagci in Spharmt.__init__ ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 343</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 344</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wvhagc</span> <span class="py-op">=</span> <span class="py-name">wvhagc</span> </span>
<span class="py-lineno"> 345</span>  <span class="py-line">                <span class="py-name">lvhsgc</span> <span class="py-op">=</span> <span class="py-number">4</span><span class="py-op">*</span><span class="py-name">nlat</span><span class="py-op">*</span><span class="py-name">n2</span><span class="py-op">+</span><span class="py-number">3</span><span class="py-op">*</span><span class="py-name">max</span><span class="py-op">(</span><span class="py-name">n1</span><span class="py-op">-</span><span class="py-number">2</span><span class="py-op">,</span><span class="py-number">0</span><span class="py-op">)</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-number">2</span><span class="py-op">*</span><span class="py-name">nlat</span><span class="py-op">-</span><span class="py-name">n1</span><span class="py-op">-</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">+</span><span class="py-name">nlon</span><span class="py-op">+</span><span class="py-number">15</span> </span>
<span class="py-lineno"> 346</span>  <span class="py-line">                <span class="py-name">wvhsgc</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">vhsgci</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-name">nlon</span><span class="py-op">,</span> <span class="py-name">lvhsgc</span><span class="py-op">,</span> <span class="py-name">ldwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 347</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 348</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to vhsgci in Spharmt.__init__ ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 349</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 350</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wvhsgc</span> <span class="py-op">=</span> <span class="py-name">wvhsgc</span> </span>
</div><span class="py-lineno"> 351</span>  <span class="py-line"> </span>
<a name="Spharmt.grdtospec"></a><div id="Spharmt.grdtospec-def"><span class="py-lineno"> 352</span> <a class="py-toggle" href="#" id="Spharmt.grdtospec-toggle" onclick="toggle('Spharmt.grdtospec'); return false;">-</a><span class="py-line">    <span class="py-keyword">def</span> <a class="py-def-name" href="spharm.spharm.Spharmt-class.html#grdtospec">grdtospec</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">datagrid</span><span class="py-op">,</span> <span class="py-param">ntrunc</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Spharmt.grdtospec-collapsed" style="display:none;" pad="++++" indent="++++++++"></div><div id="Spharmt.grdtospec-expanded"><span class="py-lineno"> 353</span>  <span class="py-line">        <span class="py-docstring">"""</span> </span>
<span class="py-lineno"> 354</span>  <span class="py-line"><span class="py-docstring"> grid to spectral transform (spherical harmonic analysis).</span> </span>
<span class="py-lineno"> 355</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 356</span>  <span class="py-line"><span class="py-docstring"> @param datagrid: rank 2 or 3 numpy float32 array with shape (nlat,nlon) or</span> </span>
<span class="py-lineno"> 357</span>  <span class="py-line"><span class="py-docstring"> (nlat,nlon,nt), where nt is the number of grids to be transformed.  If</span> </span>
<span class="py-lineno"> 358</span>  <span class="py-line"><span class="py-docstring"> datagrid is rank 2, nt is assumed to be 1.</span> </span>
<span class="py-lineno"> 359</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 360</span>  <span class="py-line"><span class="py-docstring"> @param ntrunc: spherical harmonic triangular truncation limit.</span> </span>
<span class="py-lineno"> 361</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 362</span>  <span class="py-line"><span class="py-docstring"> @return: C{B{dataspec}} - rank 1 or 2 numpy complex array with shape</span> </span>
<span class="py-lineno"> 363</span>  <span class="py-line"><span class="py-docstring"> (ntrunc+1)*(ntrunc+2)/2 or ((ntrunc+1)*(ntrunc+2)/2,nt) containing</span> </span>
<span class="py-lineno"> 364</span>  <span class="py-line"><span class="py-docstring"> complex spherical harmonic coefficients resulting from the spherical</span> </span>
<span class="py-lineno"> 365</span>  <span class="py-line"><span class="py-docstring"> harmonic analysis of datagrid.</span> </span>
<span class="py-lineno"> 366</span>  <span class="py-line"><span class="py-docstring">        """</span> </span>
<span class="py-lineno"> 367</span>  <span class="py-line"> </span>
<span class="py-lineno"> 368</span>  <span class="py-line"><span class="py-comment"># check that datagrid is rank 2 or 3 with size (self.nlat, self.nlon) or</span> </span>
<span class="py-lineno"> 369</span>  <span class="py-line"><span class="py-comment"></span><span class="py-comment"># (self.nlat, self.nlon, nt) where nt is number of grids to transform.</span> </span>
<span class="py-lineno"> 370</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 371</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">len</span><span class="py-op">(</span><span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">)</span> <span class="py-op">&gt;</span> <span class="py-number">3</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 372</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'grdtospec needs a rank two or three array, got %d'</span> <span class="py-op">%</span> <span class="py-op">(</span><span class="py-name">len</span><span class="py-op">(</span><span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">)</span><span class="py-op">,</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 373</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 374</span>  <span class="py-line"> </span>
<span class="py-lineno"> 375</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span> <span class="py-op">!=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlat</span> <span class="py-keyword">or</span> <span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">1</span><span class="py-op">]</span> <span class="py-op">!=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlon</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 376</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'grdtospec needs an array of size %d by %d, got %d by %d'</span> <span class="py-op">%</span> <span class="py-op">(</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlon</span><span class="py-op">,</span> <span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span><span class="py-op">,</span> <span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">1</span><span class="py-op">]</span><span class="py-op">,</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 377</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 378</span>  <span class="py-line"> </span>
<span class="py-lineno"> 379</span>  <span class="py-line"><span class="py-comment"># check ntrunc.</span> </span>
<span class="py-lineno"> 380</span>  <span class="py-line"><span class="py-comment"></span>   </span>
<span class="py-lineno"> 381</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">ntrunc</span> <span class="py-op">&lt;</span> <span class="py-number">0</span> <span class="py-keyword">or</span> <span class="py-name">ntrunc</span><span class="py-op">+</span><span class="py-number">1</span> <span class="py-op">&gt;</span> <span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 382</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'ntrunc must be between 0 and %d'</span> <span class="py-op">%</span> <span class="py-op">(</span><span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span><span class="py-op">-</span><span class="py-number">1</span><span class="py-op">,</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 383</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 384</span>  <span class="py-line"> </span>
<span class="py-lineno"> 385</span>  <span class="py-line"> </span>
<span class="py-lineno"> 386</span>  <span class="py-line">        <span class="py-name">nlat</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlat</span> </span>
<span class="py-lineno"> 387</span>  <span class="py-line">        <span class="py-name">nlon</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlon</span> </span>
<span class="py-lineno"> 388</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">nlat</span><span class="py-op">%</span><span class="py-number">2</span><span class="py-op">:</span>                              <span class="py-comment"># nlat is odd</span> </span>
<span class="py-lineno"> 389</span>  <span class="py-line">            <span class="py-name">n2</span> <span class="py-op">=</span> <span class="py-op">(</span><span class="py-name">nlat</span> <span class="py-op">+</span> <span class="py-number">1</span><span class="py-op">)</span><span class="py-op">/</span><span class="py-number">2</span> </span>
<span class="py-lineno"> 390</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 391</span>  <span class="py-line">            <span class="py-name">n2</span> <span class="py-op">=</span> <span class="py-name">nlat</span><span class="py-op">/</span><span class="py-number">2</span> </span>
<span class="py-lineno"> 392</span>  <span class="py-line"> </span>
<span class="py-lineno"> 393</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">len</span><span class="py-op">(</span><span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">)</span> <span class="py-op">==</span> <span class="py-number">2</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 394</span>  <span class="py-line">            <span class="py-name">nt</span> <span class="py-op">=</span> <span class="py-number">1</span> </span>
<span class="py-lineno"> 395</span>  <span class="py-line">            <span class="py-name">datagrid</span> <span class="py-op">=</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">reshape</span><span class="py-op">(</span><span class="py-name">datagrid</span><span class="py-op">,</span> <span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span><span class="py-name">nlon</span><span class="py-op">,</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 396</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 397</span>  <span class="py-line">            <span class="py-name">nt</span> <span class="py-op">=</span> <span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">2</span><span class="py-op">]</span> </span>
<span class="py-lineno"> 398</span>  <span class="py-line"> </span>
<span class="py-lineno"> 399</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">gridtype</span> <span class="py-op">==</span> <span class="py-string">'regular'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 400</span>  <span class="py-line"> </span>
<span class="py-lineno"> 401</span>  <span class="py-line"><span class="py-comment"># do grid to spectral transform.</span> </span>
<span class="py-lineno"> 402</span>  <span class="py-line"><span class="py-comment"></span>          </span>
<span class="py-lineno"> 403</span>  <span class="py-line">            <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">legfunc</span> <span class="py-op">==</span> <span class="py-string">'stored'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 404</span>  <span class="py-line">                <span class="py-name">lwork</span> <span class="py-op">=</span> <span class="py-op">(</span><span class="py-name">nt</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">*</span><span class="py-name">nlat</span><span class="py-op">*</span><span class="py-name">nlon</span> </span>
<span class="py-lineno"> 405</span>  <span class="py-line">                <span class="py-name">a</span><span class="py-op">,</span><span class="py-name">b</span><span class="py-op">,</span><span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">shaes</span><span class="py-op">(</span><span class="py-name">datagrid</span><span class="py-op">,</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wshaes</span><span class="py-op">,</span><span class="py-name">lwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 406</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 407</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to shaes in Spharmt.grdtospec ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 408</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 409</span>  <span class="py-line">            <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 410</span>  <span class="py-line">                <span class="py-name">lwork</span> <span class="py-op">=</span> <span class="py-name">nlat</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nt</span><span class="py-op">*</span><span class="py-name">nlon</span><span class="py-op">+</span><span class="py-name">max</span><span class="py-op">(</span><span class="py-number">3</span><span class="py-op">*</span><span class="py-name">n2</span><span class="py-op">,</span><span class="py-name">nlon</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 411</span>  <span class="py-line">                <span class="py-name">a</span><span class="py-op">,</span><span class="py-name">b</span><span class="py-op">,</span><span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">shaec</span><span class="py-op">(</span><span class="py-name">datagrid</span><span class="py-op">,</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wshaec</span><span class="py-op">,</span><span class="py-name">lwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 412</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 413</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to shaec in Spharmt.grdtospec ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 414</span>  <span class="py-line"> </span>
<span class="py-lineno"> 415</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 416</span>  <span class="py-line"> </span>
<span class="py-lineno"> 417</span>  <span class="py-line"><span class="py-comment"># gaussian grid.</span> </span>
<span class="py-lineno"> 418</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 419</span>  <span class="py-line">        <span class="py-keyword">elif</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">gridtype</span> <span class="py-op">==</span> <span class="py-string">'gaussian'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 420</span>  <span class="py-line"> </span>
<span class="py-lineno"> 421</span>  <span class="py-line"><span class="py-comment"># do grid to spectral transform.</span> </span>
<span class="py-lineno"> 422</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 423</span>  <span class="py-line">            <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">legfunc</span> <span class="py-op">==</span> <span class="py-string">'stored'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 424</span>  <span class="py-line">                <span class="py-name">lwork</span> <span class="py-op">=</span> <span class="py-name">nlat</span><span class="py-op">*</span><span class="py-name">nlon</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nt</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 425</span>  <span class="py-line">                <span class="py-name">a</span><span class="py-op">,</span><span class="py-name">b</span><span class="py-op">,</span><span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">shags</span><span class="py-op">(</span><span class="py-name">datagrid</span><span class="py-op">,</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wshags</span><span class="py-op">,</span><span class="py-name">lwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 426</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 427</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to shags in Spharmt.grdtospec ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 428</span>  <span class="py-line">            <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 429</span>  <span class="py-line">                <span class="py-name">lwork</span> <span class="py-op">=</span> <span class="py-name">nlat</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlon</span><span class="py-op">*</span><span class="py-name">nt</span><span class="py-op">+</span><span class="py-name">max</span><span class="py-op">(</span><span class="py-number">3</span><span class="py-op">*</span><span class="py-name">n2</span><span class="py-op">,</span><span class="py-name">nlon</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 430</span>  <span class="py-line">                <span class="py-name">a</span><span class="py-op">,</span><span class="py-name">b</span><span class="py-op">,</span><span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">shagc</span><span class="py-op">(</span><span class="py-name">datagrid</span><span class="py-op">,</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wshagc</span><span class="py-op">,</span><span class="py-name">lwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 431</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 432</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to shagc in Spharmt.grdtospec ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 433</span>  <span class="py-line"> </span>
<span class="py-lineno"> 434</span>  <span class="py-line"><span class="py-comment"># convert 2d real and imag spectral arrays into 1d complex array.</span> </span>
<span class="py-lineno"> 435</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 436</span>  <span class="py-line">        <span class="py-name">dataspec</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">twodtooned</span><span class="py-op">(</span><span class="py-name">a</span><span class="py-op">,</span><span class="py-name">b</span><span class="py-op">,</span><span class="py-name">ntrunc</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 437</span>  <span class="py-line"> </span>
<span class="py-lineno"> 438</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">nt</span><span class="py-op">==</span><span class="py-number">1</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 439</span>  <span class="py-line">            <span class="py-keyword">return</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">squeeze</span><span class="py-op">(</span><span class="py-name">dataspec</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 440</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 441</span>  <span class="py-line">            <span class="py-keyword">return</span> <span class="py-name">dataspec</span> </span>
</div><span class="py-lineno"> 442</span>  <span class="py-line"> </span>
<a name="Spharmt.spectogrd"></a><div id="Spharmt.spectogrd-def"><span class="py-lineno"> 443</span> <a class="py-toggle" href="#" id="Spharmt.spectogrd-toggle" onclick="toggle('Spharmt.spectogrd'); return false;">-</a><span class="py-line">    <span class="py-keyword">def</span> <a class="py-def-name" href="spharm.spharm.Spharmt-class.html#spectogrd">spectogrd</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">dataspec</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Spharmt.spectogrd-collapsed" style="display:none;" pad="++++" indent="++++++++"></div><div id="Spharmt.spectogrd-expanded"><span class="py-lineno"> 444</span>  <span class="py-line"> </span>
<span class="py-lineno"> 445</span>  <span class="py-line">        <span class="py-docstring">"""</span> </span>
<span class="py-lineno"> 446</span>  <span class="py-line"><span class="py-docstring"> spectral to grid transform (spherical harmonic synthesis).</span> </span>
<span class="py-lineno"> 447</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 448</span>  <span class="py-line"><span class="py-docstring"> @param dataspec: rank 1 or 2 numpy complex array with shape</span> </span>
<span class="py-lineno"> 449</span>  <span class="py-line"><span class="py-docstring"> (ntrunc+1)*(ntrunc+2)/2 or ((ntrunc+1)*(ntrunc+2)/2,nt) containing</span> </span>
<span class="py-lineno"> 450</span>  <span class="py-line"><span class="py-docstring"> complex spherical harmonic coefficients (where ntrunc is the</span> </span>
<span class="py-lineno"> 451</span>  <span class="py-line"><span class="py-docstring"> triangular truncation limit and nt is the number of spectral arrays</span> </span>
<span class="py-lineno"> 452</span>  <span class="py-line"><span class="py-docstring"> to be transformed). If dataspec is rank 1, nt is assumed to be 1.</span> </span>
<span class="py-lineno"> 453</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 454</span>  <span class="py-line"><span class="py-docstring"> @return: C{B{datagrid}} - rank 2 or 3 numpy float32 array with shape</span> </span>
<span class="py-lineno"> 455</span>  <span class="py-line"><span class="py-docstring"> (nlat,nlon) or (nlat,nlon,nt) containing the gridded data resulting from</span> </span>
<span class="py-lineno"> 456</span>  <span class="py-line"><span class="py-docstring"> the spherical harmonic synthesis of dataspec.</span> </span>
<span class="py-lineno"> 457</span>  <span class="py-line"><span class="py-docstring">        """</span> </span>
<span class="py-lineno"> 458</span>  <span class="py-line"> </span>
<span class="py-lineno"> 459</span>  <span class="py-line"><span class="py-comment"># make sure dataspec is rank 1 or 2.</span> </span>
<span class="py-lineno"> 460</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 461</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">len</span><span class="py-op">(</span><span class="py-name">dataspec</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">)</span> <span class="py-op">&gt;</span> <span class="py-number">2</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 462</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'spectogrd needs a rank one or two array, got %d'</span> <span class="py-op">%</span> <span class="py-op">(</span><span class="py-name">len</span><span class="py-op">(</span><span class="py-name">dataspec</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">)</span><span class="py-op">,</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 463</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 464</span>  <span class="py-line"> </span>
<span class="py-lineno"> 465</span>  <span class="py-line">        <span class="py-name">nlat</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlat</span> </span>
<span class="py-lineno"> 466</span>  <span class="py-line">        <span class="py-name">nlon</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlon</span> </span>
<span class="py-lineno"> 467</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">nlat</span><span class="py-op">%</span><span class="py-number">2</span><span class="py-op">:</span>                              <span class="py-comment"># nlat is odd</span> </span>
<span class="py-lineno"> 468</span>  <span class="py-line">            <span class="py-name">n2</span> <span class="py-op">=</span> <span class="py-op">(</span><span class="py-name">nlat</span> <span class="py-op">+</span> <span class="py-number">1</span><span class="py-op">)</span><span class="py-op">/</span><span class="py-number">2</span> </span>
<span class="py-lineno"> 469</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 470</span>  <span class="py-line">            <span class="py-name">n2</span> <span class="py-op">=</span> <span class="py-name">nlat</span><span class="py-op">/</span><span class="py-number">2</span> </span>
<span class="py-lineno"> 471</span>  <span class="py-line"> </span>
<span class="py-lineno"> 472</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">len</span><span class="py-op">(</span><span class="py-name">dataspec</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">)</span> <span class="py-op">==</span> <span class="py-number">1</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 473</span>  <span class="py-line">            <span class="py-name">nt</span> <span class="py-op">=</span> <span class="py-number">1</span> </span>
<span class="py-lineno"> 474</span>  <span class="py-line">            <span class="py-name">dataspec</span> <span class="py-op">=</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">reshape</span><span class="py-op">(</span><span class="py-name">dataspec</span><span class="py-op">,</span> <span class="py-op">(</span><span class="py-name">dataspec</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span><span class="py-op">,</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 475</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 476</span>  <span class="py-line">            <span class="py-name">nt</span> <span class="py-op">=</span> <span class="py-name">dataspec</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">1</span><span class="py-op">]</span> </span>
<span class="py-lineno"> 477</span>  <span class="py-line"> </span>
<span class="py-lineno"> 478</span>  <span class="py-line">        <span class="py-name">ntrunc</span> <span class="py-op">=</span> <span class="py-name">int</span><span class="py-op">(</span><span class="py-op">-</span><span class="py-number">1.5</span> <span class="py-op">+</span> <span class="py-number">0.5</span><span class="py-op">*</span><span class="py-name">math</span><span class="py-op">.</span><span class="py-name">sqrt</span><span class="py-op">(</span><span class="py-number">9.</span><span class="py-op">-</span><span class="py-number">8.</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-number">1.</span><span class="py-op">-</span><span class="py-name">dataspec</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span><span class="py-op">)</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 479</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">ntrunc</span> <span class="py-op">&gt;</span> <span class="py-name">nlat</span><span class="py-op">-</span><span class="py-number">1</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 480</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'ntrunc too large - can be max of %d, got %d'</span> <span class="py-op">%</span> <span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">-</span><span class="py-number">1</span><span class="py-op">,</span><span class="py-name">ntrunc</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 481</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 482</span>  <span class="py-line"> </span>
<span class="py-lineno"> 483</span>  <span class="py-line">        <span class="py-name">a</span><span class="py-op">,</span> <span class="py-name">b</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">onedtotwod</span><span class="py-op">(</span><span class="py-name">dataspec</span><span class="py-op">,</span><span class="py-name">nlat</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 484</span>  <span class="py-line"> </span>
<span class="py-lineno"> 485</span>  <span class="py-line"><span class="py-comment"># regular grid.</span> </span>
<span class="py-lineno"> 486</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 487</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">gridtype</span> <span class="py-op">==</span> <span class="py-string">'regular'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 488</span>  <span class="py-line"> </span>
<span class="py-lineno"> 489</span>  <span class="py-line"><span class="py-comment"># do spectral to grid transform.</span> </span>
<span class="py-lineno"> 490</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 491</span>  <span class="py-line">            <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">legfunc</span> <span class="py-op">==</span> <span class="py-string">'stored'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 492</span>  <span class="py-line">                <span class="py-name">lwork</span> <span class="py-op">=</span> <span class="py-op">(</span><span class="py-name">nt</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">*</span><span class="py-name">nlat</span><span class="py-op">*</span><span class="py-name">nlon</span> </span>
<span class="py-lineno"> 493</span>  <span class="py-line">                <span class="py-name">datagrid</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">shses</span><span class="py-op">(</span><span class="py-name">nlon</span><span class="py-op">,</span><span class="py-name">a</span><span class="py-op">,</span><span class="py-name">b</span><span class="py-op">,</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wshses</span><span class="py-op">,</span><span class="py-name">lwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 494</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 495</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to shses in Spharmt.spectogrd ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 496</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 497</span>  <span class="py-line">            <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 498</span>  <span class="py-line">                <span class="py-name">lwork</span> <span class="py-op">=</span> <span class="py-name">nlat</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nt</span><span class="py-op">*</span><span class="py-name">nlon</span><span class="py-op">+</span><span class="py-name">max</span><span class="py-op">(</span><span class="py-number">3</span><span class="py-op">*</span><span class="py-name">n2</span><span class="py-op">,</span><span class="py-name">nlon</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 499</span>  <span class="py-line">                <span class="py-name">datagrid</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">shsec</span><span class="py-op">(</span><span class="py-name">nlon</span><span class="py-op">,</span><span class="py-name">a</span><span class="py-op">,</span><span class="py-name">b</span><span class="py-op">,</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wshsec</span><span class="py-op">,</span><span class="py-name">lwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 500</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 501</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to shsec in Spharmt.spectogrd ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 502</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 503</span>  <span class="py-line"> </span>
<span class="py-lineno"> 504</span>  <span class="py-line"><span class="py-comment"># gaussian grid.</span> </span>
<span class="py-lineno"> 505</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 506</span>  <span class="py-line">        <span class="py-keyword">elif</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">gridtype</span> <span class="py-op">==</span> <span class="py-string">'gaussian'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 507</span>  <span class="py-line"> </span>
<span class="py-lineno"> 508</span>  <span class="py-line"><span class="py-comment"># do spectral to grid transform.</span> </span>
<span class="py-lineno"> 509</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 510</span>  <span class="py-line">            <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">legfunc</span> <span class="py-op">==</span> <span class="py-string">'stored'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 511</span>  <span class="py-line">                <span class="py-name">lwork</span> <span class="py-op">=</span> <span class="py-name">nlat</span><span class="py-op">*</span><span class="py-name">nlon</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nt</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 512</span>  <span class="py-line">                <span class="py-name">datagrid</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">shsgs</span><span class="py-op">(</span><span class="py-name">nlon</span><span class="py-op">,</span><span class="py-name">a</span><span class="py-op">,</span><span class="py-name">b</span><span class="py-op">,</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wshsgs</span><span class="py-op">,</span><span class="py-name">lwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 513</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 514</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to shsgs in Spharmt.spectogrd ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 515</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 516</span>  <span class="py-line">            <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 517</span>  <span class="py-line">                <span class="py-name">lwork</span> <span class="py-op">=</span> <span class="py-name">nlat</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">nlon</span><span class="py-op">*</span><span class="py-name">nt</span><span class="py-op">+</span><span class="py-name">max</span><span class="py-op">(</span><span class="py-number">3</span><span class="py-op">*</span><span class="py-name">n2</span><span class="py-op">,</span><span class="py-name">nlon</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 518</span>  <span class="py-line">                <span class="py-name">datagrid</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">shsgc</span><span class="py-op">(</span><span class="py-name">nlon</span><span class="py-op">,</span><span class="py-name">a</span><span class="py-op">,</span><span class="py-name">b</span><span class="py-op">,</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wshsgc</span><span class="py-op">,</span><span class="py-name">lwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 519</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 520</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to shsgc in Spharmt.spectogrd ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 521</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 522</span>  <span class="py-line"> </span>
<span class="py-lineno"> 523</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">nt</span><span class="py-op">==</span><span class="py-number">1</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 524</span>  <span class="py-line">            <span class="py-keyword">return</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">squeeze</span><span class="py-op">(</span><span class="py-name">datagrid</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 525</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 526</span>  <span class="py-line">            <span class="py-keyword">return</span> <span class="py-name">datagrid</span> </span>
</div><span class="py-lineno"> 527</span>  <span class="py-line"> </span>
<a name="Spharmt.getvrtdivspec"></a><div id="Spharmt.getvrtdivspec-def"><span class="py-lineno"> 528</span> <a class="py-toggle" href="#" id="Spharmt.getvrtdivspec-toggle" onclick="toggle('Spharmt.getvrtdivspec'); return false;">-</a><span class="py-line">    <span class="py-keyword">def</span> <a class="py-def-name" href="spharm.spharm.Spharmt-class.html#getvrtdivspec">getvrtdivspec</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">ugrid</span><span class="py-op">,</span> <span class="py-param">vgrid</span><span class="py-op">,</span> <span class="py-param">ntrunc</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Spharmt.getvrtdivspec-collapsed" style="display:none;" pad="++++" indent="++++++++"></div><div id="Spharmt.getvrtdivspec-expanded"><span class="py-lineno"> 529</span>  <span class="py-line"> </span>
<span class="py-lineno"> 530</span>  <span class="py-line">        <span class="py-docstring">"""</span> </span>
<span class="py-lineno"> 531</span>  <span class="py-line"><span class="py-docstring"> compute spectral coefficients of vorticity and divergence given vector wind.</span> </span>
<span class="py-lineno"> 532</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 533</span>  <span class="py-line"><span class="py-docstring"> @param ugrid: rank 2 or 3 numpy float32 array containing grid of zonal</span> </span>
<span class="py-lineno"> 534</span>  <span class="py-line"><span class="py-docstring"> winds.  Must have shape (nlat,nlon) or (nlat,nlon,nt), where nt is the number </span> </span>
<span class="py-lineno"> 535</span>  <span class="py-line"><span class="py-docstring"> of grids to be transformed.  If ugrid is rank 2, nt is assumed to be 1.</span> </span>
<span class="py-lineno"> 536</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 537</span>  <span class="py-line"><span class="py-docstring"> @param vgrid: rank 2 or 3 numpy float32 array containing grid of meridional</span> </span>
<span class="py-lineno"> 538</span>  <span class="py-line"><span class="py-docstring"> winds.  Must have shape (nlat,nlon) or (nlat,nlon,nt), where nt is the number </span> </span>
<span class="py-lineno"> 539</span>  <span class="py-line"><span class="py-docstring"> of grids to be transformed.  Both ugrid and vgrid must have the same shape.</span> </span>
<span class="py-lineno"> 540</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 541</span>  <span class="py-line"><span class="py-docstring"> @param ntrunc: spherical harmonic triangular truncation limit.</span> </span>
<span class="py-lineno"> 542</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 543</span>  <span class="py-line"><span class="py-docstring"> @return: C{B{vrtspec, divspec}} - rank 1 or 2 numpy complex arrays</span> </span>
<span class="py-lineno"> 544</span>  <span class="py-line"><span class="py-docstring"> of vorticity and divergence spherical harmonic coefficients with shape</span> </span>
<span class="py-lineno"> 545</span>  <span class="py-line"><span class="py-docstring"> shape (ntrunc+1)*(ntrunc+2)/2 or ((ntrunc+1)*(ntrunc+2)/2,nt).</span> </span>
<span class="py-lineno"> 546</span>  <span class="py-line"><span class="py-docstring">        """</span> </span>
<span class="py-lineno"> 547</span>  <span class="py-line"> </span>
<span class="py-lineno"> 548</span>  <span class="py-line"><span class="py-comment"># make sure ugrid,vgrid are rank 2 or 3 and same shape.</span> </span>
<span class="py-lineno"> 549</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 550</span>  <span class="py-line">        <span class="py-name">shapeu</span> <span class="py-op">=</span> <span class="py-name">ugrid</span><span class="py-op">.</span><span class="py-name">shape</span> </span>
<span class="py-lineno"> 551</span>  <span class="py-line">        <span class="py-name">shapev</span> <span class="py-op">=</span> <span class="py-name">vgrid</span><span class="py-op">.</span><span class="py-name">shape</span> </span>
<span class="py-lineno"> 552</span>  <span class="py-line"> </span>
<span class="py-lineno"> 553</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">shapeu</span> <span class="py-op">!=</span> <span class="py-name">shapev</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 554</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'getvrtdivspec input arrays must be same shape!'</span> </span>
<span class="py-lineno"> 555</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 556</span>  <span class="py-line"> </span>
<span class="py-lineno"> 557</span>  <span class="py-line"> </span>
<span class="py-lineno"> 558</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">len</span><span class="py-op">(</span><span class="py-name">shapeu</span><span class="py-op">)</span> <span class="py-op">!=</span><span class="py-number">2</span> <span class="py-keyword">and</span> <span class="py-name">len</span><span class="py-op">(</span><span class="py-name">shapeu</span><span class="py-op">)</span> <span class="py-op">!=</span><span class="py-number">3</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 559</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'getvrtdivspec needs rank two or three arrays!'</span> </span>
<span class="py-lineno"> 560</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 561</span>  <span class="py-line"> </span>
<span class="py-lineno"> 562</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">shapeu</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span> <span class="py-op">!=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlat</span> <span class="py-keyword">or</span> <span class="py-name">shapeu</span><span class="py-op">[</span><span class="py-number">1</span><span class="py-op">]</span> <span class="py-op">!=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlon</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 563</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'getvrtdivspec needs input arrays whose first two dimensions are si%d and %d, got %d and %d'</span> <span class="py-op">%</span> <span class="py-op">(</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlon</span><span class="py-op">,</span> <span class="py-name">ugrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span><span class="py-op">,</span> <span class="py-name">ugrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">1</span><span class="py-op">]</span><span class="py-op">,</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 564</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 565</span>  <span class="py-line"> </span>
<span class="py-lineno"> 566</span>  <span class="py-line"> </span>
<span class="py-lineno"> 567</span>  <span class="py-line"><span class="py-comment"># check ntrunc.</span> </span>
<span class="py-lineno"> 568</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 569</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">ntrunc</span> <span class="py-op">&lt;</span> <span class="py-number">0</span> <span class="py-keyword">or</span> <span class="py-name">ntrunc</span><span class="py-op">+</span><span class="py-number">1</span> <span class="py-op">&gt;</span> <span class="py-name">shapeu</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 570</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'ntrunc must be between 0 and %d'</span> <span class="py-op">%</span> <span class="py-op">(</span><span class="py-name">ugrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span><span class="py-op">-</span><span class="py-number">1</span><span class="py-op">,</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 571</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 572</span>  <span class="py-line"> </span>
<span class="py-lineno"> 573</span>  <span class="py-line">        <span class="py-name">nlat</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlat</span> </span>
<span class="py-lineno"> 574</span>  <span class="py-line">        <span class="py-name">nlon</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlon</span> </span>
<span class="py-lineno"> 575</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">nlat</span><span class="py-op">%</span><span class="py-number">2</span><span class="py-op">:</span>                              <span class="py-comment"># nlat is odd</span> </span>
<span class="py-lineno"> 576</span>  <span class="py-line">            <span class="py-name">n2</span> <span class="py-op">=</span> <span class="py-op">(</span><span class="py-name">nlat</span> <span class="py-op">+</span> <span class="py-number">1</span><span class="py-op">)</span><span class="py-op">/</span><span class="py-number">2</span> </span>
<span class="py-lineno"> 577</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 578</span>  <span class="py-line">            <span class="py-name">n2</span> <span class="py-op">=</span> <span class="py-name">nlat</span><span class="py-op">/</span><span class="py-number">2</span> </span>
<span class="py-lineno"> 579</span>  <span class="py-line">        <span class="py-name">rsphere</span><span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">rsphere</span> </span>
<span class="py-lineno"> 580</span>  <span class="py-line"> </span>
<span class="py-lineno"> 581</span>  <span class="py-line"><span class="py-comment"># convert from geographical to math coordinates, add extra dimension</span> </span>
<span class="py-lineno"> 582</span>  <span class="py-line"><span class="py-comment"></span><span class="py-comment"># if necessary.</span> </span>
<span class="py-lineno"> 583</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 584</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">len</span><span class="py-op">(</span><span class="py-name">shapeu</span><span class="py-op">)</span> <span class="py-op">==</span> <span class="py-number">2</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 585</span>  <span class="py-line">            <span class="py-name">nt</span> <span class="py-op">=</span> <span class="py-number">1</span> </span>
<span class="py-lineno"> 586</span>  <span class="py-line">            <span class="py-name">w</span> <span class="py-op">=</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">reshape</span><span class="py-op">(</span><span class="py-name">ugrid</span><span class="py-op">,</span> <span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span><span class="py-name">nlon</span><span class="py-op">,</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 587</span>  <span class="py-line">            <span class="py-name">v</span> <span class="py-op">=</span> <span class="py-op">-</span><span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">reshape</span><span class="py-op">(</span><span class="py-name">vgrid</span><span class="py-op">,</span> <span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span><span class="py-name">nlon</span><span class="py-op">,</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 588</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 589</span>  <span class="py-line">            <span class="py-name">nt</span> <span class="py-op">=</span> <span class="py-name">shapeu</span><span class="py-op">[</span><span class="py-number">2</span><span class="py-op">]</span> </span>
<span class="py-lineno"> 590</span>  <span class="py-line">            <span class="py-name">w</span> <span class="py-op">=</span> <span class="py-name">ugrid</span> </span>
<span class="py-lineno"> 591</span>  <span class="py-line">            <span class="py-name">v</span> <span class="py-op">=</span> <span class="py-op">-</span><span class="py-name">vgrid</span> </span>
<span class="py-lineno"> 592</span>  <span class="py-line"> </span>
<span class="py-lineno"> 593</span>  <span class="py-line"><span class="py-comment"># regular grid.</span> </span>
<span class="py-lineno"> 594</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 595</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">gridtype</span> <span class="py-op">==</span> <span class="py-string">'regular'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 596</span>  <span class="py-line"> </span>
<span class="py-lineno"> 597</span>  <span class="py-line"><span class="py-comment"># vector harmonic analysis.</span> </span>
<span class="py-lineno"> 598</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 599</span>  <span class="py-line">            <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">legfunc</span> <span class="py-op">==</span> <span class="py-string">'stored'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 600</span>  <span class="py-line">                <span class="py-name">lwork</span> <span class="py-op">=</span> <span class="py-op">(</span><span class="py-number">2</span><span class="py-op">*</span><span class="py-name">nt</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">*</span><span class="py-name">nlat</span><span class="py-op">*</span><span class="py-name">nlon</span> </span>
<span class="py-lineno"> 601</span>  <span class="py-line">                <span class="py-name">br</span><span class="py-op">,</span><span class="py-name">bi</span><span class="py-op">,</span><span class="py-name">cr</span><span class="py-op">,</span><span class="py-name">ci</span><span class="py-op">,</span><span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">vhaes</span><span class="py-op">(</span><span class="py-name">v</span><span class="py-op">,</span><span class="py-name">w</span><span class="py-op">,</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wvhaes</span><span class="py-op">,</span><span class="py-name">lwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 602</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 603</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to vhaes in Spharmt.getvrtdivspec ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 604</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 605</span>  <span class="py-line">            <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 606</span>  <span class="py-line">                <span class="py-name">lwork</span> <span class="py-op">=</span> <span class="py-name">nlat</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-number">2</span><span class="py-op">*</span><span class="py-name">nt</span><span class="py-op">*</span><span class="py-name">nlon</span><span class="py-op">+</span><span class="py-name">max</span><span class="py-op">(</span><span class="py-number">6</span><span class="py-op">*</span><span class="py-name">n2</span><span class="py-op">,</span><span class="py-name">nlon</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 607</span>  <span class="py-line">                <span class="py-name">br</span><span class="py-op">,</span><span class="py-name">bi</span><span class="py-op">,</span><span class="py-name">cr</span><span class="py-op">,</span><span class="py-name">ci</span><span class="py-op">,</span><span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">vhaec</span><span class="py-op">(</span><span class="py-name">v</span><span class="py-op">,</span><span class="py-name">w</span><span class="py-op">,</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wvhaec</span><span class="py-op">,</span><span class="py-name">lwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 608</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 609</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to vhaec in Spharmt.getvrtdivspec ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 610</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 611</span>  <span class="py-line"> </span>
<span class="py-lineno"> 612</span>  <span class="py-line"><span class="py-comment"># gaussian grid.</span> </span>
<span class="py-lineno"> 613</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 614</span>  <span class="py-line">        <span class="py-keyword">elif</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">gridtype</span> <span class="py-op">==</span> <span class="py-string">'gaussian'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 615</span>  <span class="py-line"> </span>
<span class="py-lineno"> 616</span>  <span class="py-line"><span class="py-comment"># vector harmonic analysis.</span> </span>
<span class="py-lineno"> 617</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 618</span>  <span class="py-line">            <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">legfunc</span> <span class="py-op">==</span> <span class="py-string">'stored'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 619</span>  <span class="py-line">                <span class="py-name">lwork</span> <span class="py-op">=</span> <span class="py-op">(</span><span class="py-number">2</span><span class="py-op">*</span><span class="py-name">nt</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">*</span><span class="py-name">nlat</span><span class="py-op">*</span><span class="py-name">nlon</span> </span>
<span class="py-lineno"> 620</span>  <span class="py-line">                <span class="py-name">br</span><span class="py-op">,</span><span class="py-name">bi</span><span class="py-op">,</span><span class="py-name">cr</span><span class="py-op">,</span><span class="py-name">ci</span><span class="py-op">,</span><span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">vhags</span><span class="py-op">(</span><span class="py-name">v</span><span class="py-op">,</span><span class="py-name">w</span><span class="py-op">,</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wvhags</span><span class="py-op">,</span><span class="py-name">lwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 621</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 622</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to vhags in Spharmt.getvrtdivspec ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 623</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 624</span>  <span class="py-line">            <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 625</span>  <span class="py-line">                <span class="py-name">lwork</span> <span class="py-op">=</span> <span class="py-number">2</span><span class="py-op">*</span><span class="py-name">nlat</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-number">2</span><span class="py-op">*</span><span class="py-name">nlon</span><span class="py-op">*</span><span class="py-name">nt</span><span class="py-op">+</span><span class="py-number">3</span><span class="py-op">*</span><span class="py-name">n2</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 626</span>  <span class="py-line">                <span class="py-name">br</span><span class="py-op">,</span><span class="py-name">bi</span><span class="py-op">,</span><span class="py-name">cr</span><span class="py-op">,</span><span class="py-name">ci</span><span class="py-op">,</span><span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">vhagc</span><span class="py-op">(</span><span class="py-name">v</span><span class="py-op">,</span><span class="py-name">w</span><span class="py-op">,</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wvhagc</span><span class="py-op">,</span><span class="py-name">lwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 627</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 628</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to vhagc in Spharmt.getvrtdivspec ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 629</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 630</span>  <span class="py-line"> </span>
<span class="py-lineno"> 631</span>  <span class="py-line"><span class="py-comment"># convert vector harmonic coeffs to 1d complex coefficients</span> </span>
<span class="py-lineno"> 632</span>  <span class="py-line"><span class="py-comment"></span><span class="py-comment"># of vorticity and divergence.</span> </span>
<span class="py-lineno"> 633</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 634</span>  <span class="py-line">        <span class="py-name">vrtspec</span><span class="py-op">,</span> <span class="py-name">divspec</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">twodtooned_vrtdiv</span><span class="py-op">(</span><span class="py-name">br</span><span class="py-op">,</span><span class="py-name">bi</span><span class="py-op">,</span><span class="py-name">cr</span><span class="py-op">,</span><span class="py-name">ci</span><span class="py-op">,</span><span class="py-name">ntrunc</span><span class="py-op">,</span><span class="py-name">rsphere</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 635</span>  <span class="py-line"> </span>
<span class="py-lineno"> 636</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">nt</span><span class="py-op">==</span><span class="py-number">1</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 637</span>  <span class="py-line">            <span class="py-keyword">return</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">squeeze</span><span class="py-op">(</span><span class="py-name">vrtspec</span><span class="py-op">)</span><span class="py-op">,</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">squeeze</span><span class="py-op">(</span><span class="py-name">divspec</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 638</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 639</span>  <span class="py-line">            <span class="py-keyword">return</span> <span class="py-name">vrtspec</span><span class="py-op">,</span> <span class="py-name">divspec</span> </span>
</div><span class="py-lineno"> 640</span>  <span class="py-line"> </span>
<a name="Spharmt.getuv"></a><div id="Spharmt.getuv-def"><span class="py-lineno"> 641</span> <a class="py-toggle" href="#" id="Spharmt.getuv-toggle" onclick="toggle('Spharmt.getuv'); return false;">-</a><span class="py-line">    <span class="py-keyword">def</span> <a class="py-def-name" href="spharm.spharm.Spharmt-class.html#getuv">getuv</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">vrtspec</span><span class="py-op">,</span> <span class="py-param">divspec</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Spharmt.getuv-collapsed" style="display:none;" pad="++++" indent="++++++++"></div><div id="Spharmt.getuv-expanded"><span class="py-lineno"> 642</span>  <span class="py-line"> </span>
<span class="py-lineno"> 643</span>  <span class="py-line">        <span class="py-docstring">"""</span> </span>
<span class="py-lineno"> 644</span>  <span class="py-line"><span class="py-docstring"> compute vector wind on grid given complex spectral coefficients</span> </span>
<span class="py-lineno"> 645</span>  <span class="py-line"><span class="py-docstring"> of vorticity and divergence.</span> </span>
<span class="py-lineno"> 646</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 647</span>  <span class="py-line"><span class="py-docstring"> @param vrtspec: rank 1 or 2 numpy complex array of vorticity spectral</span> </span>
<span class="py-lineno"> 648</span>  <span class="py-line"><span class="py-docstring"> coefficients, with shape (ntrunc+1)*(ntrunc+2)/2 or</span> </span>
<span class="py-lineno"> 649</span>  <span class="py-line"><span class="py-docstring"> ((ntrunc+1)*(ntrunc+2)/2,nt) (where ntrunc is the triangular truncation</span> </span>
<span class="py-lineno"> 650</span>  <span class="py-line"><span class="py-docstring"> and nt is the number of spectral arrays to be transformed).</span> </span>
<span class="py-lineno"> 651</span>  <span class="py-line"><span class="py-docstring"> If vrtspec is rank 1, nt is assumed to be 1.</span> </span>
<span class="py-lineno"> 652</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 653</span>  <span class="py-line"><span class="py-docstring"> @param divspec: rank 1 or 2 numpy complex array of divergence spectral</span> </span>
<span class="py-lineno"> 654</span>  <span class="py-line"><span class="py-docstring"> coefficients, with shape (ntrunc+1)*(ntrunc+2)/2 or</span> </span>
<span class="py-lineno"> 655</span>  <span class="py-line"><span class="py-docstring"> ((ntrunc+1)*(ntrunc+2)/2,nt) (where ntrunc is the triangular truncation</span> </span>
<span class="py-lineno"> 656</span>  <span class="py-line"><span class="py-docstring"> and nt is the number of spectral arrays to be transformed).</span> </span>
<span class="py-lineno"> 657</span>  <span class="py-line"><span class="py-docstring"> Both vrtspec and divspec must have the same shape.</span> </span>
<span class="py-lineno"> 658</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 659</span>  <span class="py-line"><span class="py-docstring"> @return: C{B{ugrid, vgrid}} - rank 2 or 3 numpy float32 arrays containing</span> </span>
<span class="py-lineno"> 660</span>  <span class="py-line"><span class="py-docstring"> gridded zonal and meridional winds. Shapes are either (nlat,nlon) or</span> </span>
<span class="py-lineno"> 661</span>  <span class="py-line"><span class="py-docstring"> (nlat,nlon,nt).</span> </span>
<span class="py-lineno"> 662</span>  <span class="py-line"><span class="py-docstring">        """</span> </span>
<span class="py-lineno"> 663</span>  <span class="py-line"> </span>
<span class="py-lineno"> 664</span>  <span class="py-line">        <span class="py-name">shapevrt</span> <span class="py-op">=</span> <span class="py-name">vrtspec</span><span class="py-op">.</span><span class="py-name">shape</span> </span>
<span class="py-lineno"> 665</span>  <span class="py-line">        <span class="py-name">shapediv</span> <span class="py-op">=</span> <span class="py-name">divspec</span><span class="py-op">.</span><span class="py-name">shape</span> </span>
<span class="py-lineno"> 666</span>  <span class="py-line"> </span>
<span class="py-lineno"> 667</span>  <span class="py-line"><span class="py-comment"># make sure vrtspec, divspec are rank 1 or 2, and have the same shape.</span> </span>
<span class="py-lineno"> 668</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 669</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">shapevrt</span> <span class="py-op">!=</span> <span class="py-name">shapediv</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 670</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'vrtspec, divspec must be same size in getuv!'</span> </span>
<span class="py-lineno"> 671</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 672</span>  <span class="py-line"> </span>
<span class="py-lineno"> 673</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">len</span><span class="py-op">(</span><span class="py-name">shapevrt</span><span class="py-op">)</span> <span class="py-op">!=</span><span class="py-number">1</span> <span class="py-keyword">and</span> <span class="py-name">len</span><span class="py-op">(</span><span class="py-name">shapevrt</span><span class="py-op">)</span> <span class="py-op">!=</span><span class="py-number">2</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 674</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'getuv needs rank one or two input arrays!'</span> </span>
<span class="py-lineno"> 675</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 676</span>  <span class="py-line"> </span>
<span class="py-lineno"> 677</span>  <span class="py-line"><span class="py-comment"># infer ntrunc from size of dataspec (dataspec must be rank 1!)</span> </span>
<span class="py-lineno"> 678</span>  <span class="py-line"><span class="py-comment"></span><span class="py-comment"># dataspec is assumed to have size (ntrunc+1)*(ntrunc+2)/2</span> </span>
<span class="py-lineno"> 679</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 680</span>  <span class="py-line">        <span class="py-name">ntrunc</span> <span class="py-op">=</span> <span class="py-name">int</span><span class="py-op">(</span><span class="py-op">-</span><span class="py-number">1.5</span> <span class="py-op">+</span> <span class="py-number">0.5</span><span class="py-op">*</span><span class="py-name">math</span><span class="py-op">.</span><span class="py-name">sqrt</span><span class="py-op">(</span><span class="py-number">9.</span><span class="py-op">-</span><span class="py-number">8.</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-number">1.</span><span class="py-op">-</span><span class="py-name">vrtspec</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span><span class="py-op">)</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 681</span>  <span class="py-line"> </span>
<span class="py-lineno"> 682</span>  <span class="py-line">        <span class="py-name">nlat</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlat</span> </span>
<span class="py-lineno"> 683</span>  <span class="py-line">        <span class="py-name">nlon</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlon</span> </span>
<span class="py-lineno"> 684</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">nlat</span><span class="py-op">%</span><span class="py-number">2</span><span class="py-op">:</span>                              <span class="py-comment"># nlat is odd</span> </span>
<span class="py-lineno"> 685</span>  <span class="py-line">            <span class="py-name">n2</span> <span class="py-op">=</span> <span class="py-op">(</span><span class="py-name">nlat</span> <span class="py-op">+</span> <span class="py-number">1</span><span class="py-op">)</span><span class="py-op">/</span><span class="py-number">2</span> </span>
<span class="py-lineno"> 686</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 687</span>  <span class="py-line">            <span class="py-name">n2</span> <span class="py-op">=</span> <span class="py-name">nlat</span><span class="py-op">/</span><span class="py-number">2</span> </span>
<span class="py-lineno"> 688</span>  <span class="py-line">        <span class="py-name">rsphere</span><span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">rsphere</span> </span>
<span class="py-lineno"> 689</span>  <span class="py-line"> </span>
<span class="py-lineno"> 690</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">len</span><span class="py-op">(</span><span class="py-name">vrtspec</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">)</span> <span class="py-op">==</span> <span class="py-number">1</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 691</span>  <span class="py-line">            <span class="py-name">nt</span> <span class="py-op">=</span> <span class="py-number">1</span> </span>
<span class="py-lineno"> 692</span>  <span class="py-line">            <span class="py-name">vrtspec</span> <span class="py-op">=</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">reshape</span><span class="py-op">(</span><span class="py-name">vrtspec</span><span class="py-op">,</span> <span class="py-op">(</span><span class="py-name">vrtspec</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span><span class="py-op">,</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 693</span>  <span class="py-line">            <span class="py-name">divspec</span> <span class="py-op">=</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">reshape</span><span class="py-op">(</span><span class="py-name">divspec</span><span class="py-op">,</span> <span class="py-op">(</span><span class="py-name">divspec</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span><span class="py-op">,</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 694</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 695</span>  <span class="py-line">            <span class="py-name">nt</span> <span class="py-op">=</span> <span class="py-name">vrtspec</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">1</span><span class="py-op">]</span> </span>
<span class="py-lineno"> 696</span>  <span class="py-line"> </span>
<span class="py-lineno"> 697</span>  <span class="py-line"><span class="py-comment"># convert 1d complex arrays of vort, div to 2d vector harmonic arrays.</span> </span>
<span class="py-lineno"> 698</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 699</span>  <span class="py-line">        <span class="py-name">br</span><span class="py-op">,</span><span class="py-name">bi</span><span class="py-op">,</span><span class="py-name">cr</span><span class="py-op">,</span><span class="py-name">ci</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">onedtotwod_vrtdiv</span><span class="py-op">(</span><span class="py-name">vrtspec</span><span class="py-op">,</span><span class="py-name">divspec</span><span class="py-op">,</span><span class="py-name">nlat</span><span class="py-op">,</span><span class="py-name">rsphere</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 700</span>  <span class="py-line"> </span>
<span class="py-lineno"> 701</span>  <span class="py-line"><span class="py-comment"># regular grid.</span> </span>
<span class="py-lineno"> 702</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 703</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">gridtype</span> <span class="py-op">==</span> <span class="py-string">'regular'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 704</span>  <span class="py-line"> </span>
<span class="py-lineno"> 705</span>  <span class="py-line"><span class="py-comment"># vector harmonic synthesis.</span> </span>
<span class="py-lineno"> 706</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 707</span>  <span class="py-line">            <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">legfunc</span> <span class="py-op">==</span> <span class="py-string">'stored'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 708</span>  <span class="py-line">                <span class="py-name">lwork</span> <span class="py-op">=</span> <span class="py-op">(</span><span class="py-number">2</span><span class="py-op">*</span><span class="py-name">nt</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">*</span><span class="py-name">nlat</span><span class="py-op">*</span><span class="py-name">nlon</span> </span>
<span class="py-lineno"> 709</span>  <span class="py-line">                <span class="py-name">v</span><span class="py-op">,</span> <span class="py-name">w</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">vhses</span><span class="py-op">(</span><span class="py-name">nlon</span><span class="py-op">,</span><span class="py-name">br</span><span class="py-op">,</span><span class="py-name">bi</span><span class="py-op">,</span><span class="py-name">cr</span><span class="py-op">,</span><span class="py-name">ci</span><span class="py-op">,</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wvhses</span><span class="py-op">,</span><span class="py-name">lwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 710</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 711</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to vhses in Spharmt.getuv ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 712</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 713</span>  <span class="py-line">            <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 714</span>  <span class="py-line">                <span class="py-name">lwork</span> <span class="py-op">=</span> <span class="py-name">nlat</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-number">2</span><span class="py-op">*</span><span class="py-name">nt</span><span class="py-op">*</span><span class="py-name">nlon</span><span class="py-op">+</span><span class="py-name">max</span><span class="py-op">(</span><span class="py-number">6</span><span class="py-op">*</span><span class="py-name">n2</span><span class="py-op">,</span><span class="py-name">nlon</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 715</span>  <span class="py-line">                <span class="py-name">v</span><span class="py-op">,</span> <span class="py-name">w</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">vhsec</span><span class="py-op">(</span><span class="py-name">nlon</span><span class="py-op">,</span><span class="py-name">br</span><span class="py-op">,</span><span class="py-name">bi</span><span class="py-op">,</span><span class="py-name">cr</span><span class="py-op">,</span><span class="py-name">ci</span><span class="py-op">,</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wvhsec</span><span class="py-op">,</span><span class="py-name">lwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 716</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 717</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to vhsec in Spharmt.getuv ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 718</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 719</span>  <span class="py-line"> </span>
<span class="py-lineno"> 720</span>  <span class="py-line"><span class="py-comment"># gaussian grid.</span> </span>
<span class="py-lineno"> 721</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 722</span>  <span class="py-line">        <span class="py-keyword">elif</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">gridtype</span> <span class="py-op">==</span> <span class="py-string">'gaussian'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 723</span>  <span class="py-line"> </span>
<span class="py-lineno"> 724</span>  <span class="py-line"><span class="py-comment"># vector harmonic synthesis.</span> </span>
<span class="py-lineno"> 725</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 726</span>  <span class="py-line">            <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">legfunc</span> <span class="py-op">==</span> <span class="py-string">'stored'</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 727</span>  <span class="py-line">                <span class="py-name">lwork</span> <span class="py-op">=</span> <span class="py-op">(</span><span class="py-number">2</span><span class="py-op">*</span><span class="py-name">nt</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">*</span><span class="py-name">nlat</span><span class="py-op">*</span><span class="py-name">nlon</span> </span>
<span class="py-lineno"> 728</span>  <span class="py-line">                <span class="py-name">v</span><span class="py-op">,</span> <span class="py-name">w</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">vhsgs</span><span class="py-op">(</span><span class="py-name">nlon</span><span class="py-op">,</span><span class="py-name">br</span><span class="py-op">,</span><span class="py-name">bi</span><span class="py-op">,</span><span class="py-name">cr</span><span class="py-op">,</span><span class="py-name">ci</span><span class="py-op">,</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wvhsgs</span><span class="py-op">,</span><span class="py-name">lwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 729</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 730</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to vhsgs in Spharmt.getuv ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 731</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 732</span>  <span class="py-line">            <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 733</span>  <span class="py-line">                <span class="py-name">lwork</span> <span class="py-op">=</span> <span class="py-name">nlat</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-number">2</span><span class="py-op">*</span><span class="py-name">nt</span><span class="py-op">*</span><span class="py-name">nlon</span><span class="py-op">+</span><span class="py-name">max</span><span class="py-op">(</span><span class="py-number">6</span><span class="py-op">*</span><span class="py-name">n2</span><span class="py-op">,</span><span class="py-name">nlon</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 734</span>  <span class="py-line">                <span class="py-name">v</span><span class="py-op">,</span> <span class="py-name">w</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">vhsgc</span><span class="py-op">(</span><span class="py-name">nlon</span><span class="py-op">,</span><span class="py-name">br</span><span class="py-op">,</span><span class="py-name">bi</span><span class="py-op">,</span><span class="py-name">cr</span><span class="py-op">,</span><span class="py-name">ci</span><span class="py-op">,</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">wvhsgc</span><span class="py-op">,</span><span class="py-name">lwork</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 735</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 736</span>  <span class="py-line">                    <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to vhsgc in Spharmt.getuv ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 737</span>  <span class="py-line">                    <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 738</span>  <span class="py-line"> </span>
<span class="py-lineno"> 739</span>  <span class="py-line"><span class="py-comment"># convert to u and v in geographical coordinates.</span> </span>
<span class="py-lineno"> 740</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 741</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">nt</span> <span class="py-op">==</span> <span class="py-number">1</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 742</span>  <span class="py-line">            <span class="py-keyword">return</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">reshape</span><span class="py-op">(</span><span class="py-name">w</span><span class="py-op">,</span> <span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span><span class="py-name">nlon</span><span class="py-op">)</span><span class="py-op">)</span><span class="py-op">,</span> <span class="py-op">-</span><span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">reshape</span><span class="py-op">(</span><span class="py-name">v</span><span class="py-op">,</span> <span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">,</span><span class="py-name">nlon</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 743</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 744</span>  <span class="py-line">            <span class="py-keyword">return</span> <span class="py-name">w</span><span class="py-op">,</span><span class="py-op">-</span><span class="py-name">v</span> </span>
</div><span class="py-lineno"> 745</span>  <span class="py-line"> </span>
<a name="Spharmt.getpsichi"></a><div id="Spharmt.getpsichi-def"><span class="py-lineno"> 746</span> <a class="py-toggle" href="#" id="Spharmt.getpsichi-toggle" onclick="toggle('Spharmt.getpsichi'); return false;">-</a><span class="py-line">    <span class="py-keyword">def</span> <a class="py-def-name" href="spharm.spharm.Spharmt-class.html#getpsichi">getpsichi</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">ugrid</span><span class="py-op">,</span> <span class="py-param">vgrid</span><span class="py-op">,</span> <span class="py-param">ntrunc</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Spharmt.getpsichi-collapsed" style="display:none;" pad="++++" indent="++++++++"></div><div id="Spharmt.getpsichi-expanded"><span class="py-lineno"> 747</span>  <span class="py-line"> </span>
<span class="py-lineno"> 748</span>  <span class="py-line">        <span class="py-docstring">"""</span> </span>
<span class="py-lineno"> 749</span>  <span class="py-line"><span class="py-docstring"> compute streamfunction and velocity potential on grid given vector wind.</span> </span>
<span class="py-lineno"> 750</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 751</span>  <span class="py-line"><span class="py-docstring"> @param ugrid: rank 2 or 3 numpy float32 array containing grid of zonal</span> </span>
<span class="py-lineno"> 752</span>  <span class="py-line"><span class="py-docstring"> winds.  Must have shape (nlat,nlon) or (nlat,nlon,nt), where nt is the number </span> </span>
<span class="py-lineno"> 753</span>  <span class="py-line"><span class="py-docstring"> of grids to be transformed.  If ugrid is rank 2, nt is assumed to be 1.</span> </span>
<span class="py-lineno"> 754</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 755</span>  <span class="py-line"><span class="py-docstring"> @param vgrid: rank 2 or 3 numpy float32 array containing grid of meridional</span> </span>
<span class="py-lineno"> 756</span>  <span class="py-line"><span class="py-docstring"> winds.  Must have shape (nlat,nlon) or (nlat,nlon,nt), where nt is the number </span> </span>
<span class="py-lineno"> 757</span>  <span class="py-line"><span class="py-docstring"> of grids to be transformed.  Both ugrid and vgrid must have the same shape.</span> </span>
<span class="py-lineno"> 758</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 759</span>  <span class="py-line"><span class="py-docstring"> @return: C{B{psigrid, chigrid}} - rank 2 or 3 numpy float32 arrays</span> </span>
<span class="py-lineno"> 760</span>  <span class="py-line"><span class="py-docstring"> of gridded streamfunction and velocity potential. Shapes are either</span> </span>
<span class="py-lineno"> 761</span>  <span class="py-line"><span class="py-docstring"> (nlat,nlon) or (nlat,nlon,nt).</span> </span>
<span class="py-lineno"> 762</span>  <span class="py-line"><span class="py-docstring">        """</span> </span>
<span class="py-lineno"> 763</span>  <span class="py-line"> </span>
<span class="py-lineno"> 764</span>  <span class="py-line"><span class="py-comment"># make sure ugrid,vgrid are rank 2 or 3 and same shape.</span> </span>
<span class="py-lineno"> 765</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 766</span>  <span class="py-line">        <span class="py-name">shapeu</span> <span class="py-op">=</span> <span class="py-name">ugrid</span><span class="py-op">.</span><span class="py-name">shape</span> </span>
<span class="py-lineno"> 767</span>  <span class="py-line">        <span class="py-name">shapev</span> <span class="py-op">=</span> <span class="py-name">vgrid</span><span class="py-op">.</span><span class="py-name">shape</span> </span>
<span class="py-lineno"> 768</span>  <span class="py-line"> </span>
<span class="py-lineno"> 769</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">shapeu</span> <span class="py-op">!=</span> <span class="py-name">shapev</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 770</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'getvrtdivspec input arrays must be same shape!'</span> </span>
<span class="py-lineno"> 771</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 772</span>  <span class="py-line"> </span>
<span class="py-lineno"> 773</span>  <span class="py-line"> </span>
<span class="py-lineno"> 774</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">len</span><span class="py-op">(</span><span class="py-name">shapeu</span><span class="py-op">)</span> <span class="py-op">!=</span><span class="py-number">2</span> <span class="py-keyword">and</span> <span class="py-name">len</span><span class="py-op">(</span><span class="py-name">shapeu</span><span class="py-op">)</span> <span class="py-op">!=</span><span class="py-number">3</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 775</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'getvrtdivspec needs rank two or three arrays!'</span> </span>
<span class="py-lineno"> 776</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 777</span>  <span class="py-line"> </span>
<span class="py-lineno"> 778</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">shapeu</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span> <span class="py-op">!=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlat</span> <span class="py-keyword">or</span> <span class="py-name">shapeu</span><span class="py-op">[</span><span class="py-number">1</span><span class="py-op">]</span> <span class="py-op">!=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlon</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 779</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'getpsichi needs input arrays whose first two dimensions are si%d and %d, got %d and %d'</span> <span class="py-op">%</span> <span class="py-op">(</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlon</span><span class="py-op">,</span> <span class="py-name">ugrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span><span class="py-op">,</span> <span class="py-name">ugrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">1</span><span class="py-op">]</span><span class="py-op">,</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 780</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 781</span>  <span class="py-line"> </span>
<span class="py-lineno"> 782</span>  <span class="py-line"><span class="py-comment"># check ntrunc.</span> </span>
<span class="py-lineno"> 783</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 784</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">ntrunc</span> <span class="py-op">&lt;</span> <span class="py-number">0</span> <span class="py-keyword">or</span> <span class="py-name">ntrunc</span><span class="py-op">+</span><span class="py-number">1</span> <span class="py-op">&gt;</span> <span class="py-name">ugrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 785</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'ntrunc must be between 0 and %d'</span> <span class="py-op">%</span> <span class="py-op">(</span><span class="py-name">ugrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span><span class="py-op">-</span><span class="py-number">1</span><span class="py-op">,</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 786</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 787</span>  <span class="py-line"> </span>
<span class="py-lineno"> 788</span>  <span class="py-line"><span class="py-comment"># compute spectral coeffs of vort, div.</span> </span>
<span class="py-lineno"> 789</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 790</span>  <span class="py-line">        <span class="py-name">vrtspec</span><span class="py-op">,</span> <span class="py-name">divspec</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-4" class="py-name"><a title="spharm.spharm.Spharmt.getvrtdivspec" class="py-name" href="#" onclick="doclink('link-4', 'getvrtdivspec', 'Method spharm.spharm.Spharmt.getvrtdivspec()=spharm.spharm.Spharmt-class.html#getvrtdivspec'); return false;">getvrtdivspec</a></span></span><span class="py-op">(</span><span class="py-name">ugrid</span><span class="py-op">,</span> <span class="py-name">vgrid</span><span class="py-op">,</span> <span class="py-name">ntrunc</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 791</span>  <span class="py-line"> </span>
<span class="py-lineno"> 792</span>  <span class="py-line"><span class="py-comment"># number of grids to compute.</span> </span>
<span class="py-lineno"> 793</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 794</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">len</span><span class="py-op">(</span><span class="py-name">vrtspec</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">)</span> <span class="py-op">==</span> <span class="py-number">1</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 795</span>  <span class="py-line">            <span class="py-name">nt</span> <span class="py-op">=</span> <span class="py-number">1</span> </span>
<span class="py-lineno"> 796</span>  <span class="py-line">            <span class="py-name">vrtspec</span> <span class="py-op">=</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">reshape</span><span class="py-op">(</span><span class="py-name">vrtspec</span><span class="py-op">,</span> <span class="py-op">(</span><span class="py-op">(</span><span class="py-name">ntrunc</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">ntrunc</span><span class="py-op">+</span><span class="py-number">2</span><span class="py-op">)</span><span class="py-op">/</span><span class="py-number">2</span><span class="py-op">,</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 797</span>  <span class="py-line">            <span class="py-name">divspec</span> <span class="py-op">=</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">reshape</span><span class="py-op">(</span><span class="py-name">divspec</span><span class="py-op">,</span> <span class="py-op">(</span><span class="py-op">(</span><span class="py-name">ntrunc</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">ntrunc</span><span class="py-op">+</span><span class="py-number">2</span><span class="py-op">)</span><span class="py-op">/</span><span class="py-number">2</span><span class="py-op">,</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 798</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 799</span>  <span class="py-line">            <span class="py-name">nt</span> <span class="py-op">=</span> <span class="py-name">vrtspec</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">1</span><span class="py-op">]</span> </span>
<span class="py-lineno"> 800</span>  <span class="py-line"> </span>
<span class="py-lineno"> 801</span>  <span class="py-line"><span class="py-comment"># convert to spectral coeffs of psi, chi.</span> </span>
<span class="py-lineno"> 802</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 803</span>  <span class="py-line">        <span class="py-name">psispec</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">invlap</span><span class="py-op">(</span><span class="py-name">vrtspec</span><span class="py-op">,</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">rsphere</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 804</span>  <span class="py-line">        <span class="py-name">chispec</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">invlap</span><span class="py-op">(</span><span class="py-name">divspec</span><span class="py-op">,</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">rsphere</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 805</span>  <span class="py-line"> </span>
<span class="py-lineno"> 806</span>  <span class="py-line"><span class="py-comment"># inverse transform to grid.</span> </span>
<span class="py-lineno"> 807</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 808</span>  <span class="py-line">        <span class="py-name">psigrid</span> <span class="py-op">=</span>  <span class="py-name">self</span><span class="py-op">.</span><span id="link-5" class="py-name"><a title="spharm.spharm.Spharmt.spectogrd" class="py-name" href="#" onclick="doclink('link-5', 'spectogrd', 'Method spharm.spharm.Spharmt.spectogrd()=spharm.spharm.Spharmt-class.html#spectogrd'); return false;">spectogrd</a></span></span><span class="py-op">(</span><span class="py-name">psispec</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 809</span>  <span class="py-line">        <span class="py-name">chigrid</span> <span class="py-op">=</span>  <span class="py-name">self</span><span class="py-op">.</span><span id="link-6" class="py-name"><a title="spharm.spharm.Spharmt.spectogrd" class="py-name" href="#" onclick="doclink('link-6', 'spectogrd', 'Method spharm.spharm.Spharmt.spectogrd()=spharm.spharm.Spharmt-class.html#spectogrd'); return false;">spectogrd</a></span></span><span class="py-op">(</span><span class="py-name">chispec</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 810</span>  <span class="py-line"> </span>
<span class="py-lineno"> 811</span>  <span class="py-line">        <span class="py-keyword">return</span> <span class="py-name">psigrid</span><span class="py-op">,</span> <span class="py-name">chigrid</span> </span>
</div><span class="py-lineno"> 812</span>  <span class="py-line"> </span>
<a name="Spharmt.getgrad"></a><div id="Spharmt.getgrad-def"><span class="py-lineno"> 813</span> <a class="py-toggle" href="#" id="Spharmt.getgrad-toggle" onclick="toggle('Spharmt.getgrad'); return false;">-</a><span class="py-line">    <span class="py-keyword">def</span> <a class="py-def-name" href="spharm.spharm.Spharmt-class.html#getgrad">getgrad</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">chispec</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Spharmt.getgrad-collapsed" style="display:none;" pad="++++" indent="++++++++"></div><div id="Spharmt.getgrad-expanded"><span class="py-lineno"> 814</span>  <span class="py-line"> </span>
<span class="py-lineno"> 815</span>  <span class="py-line">        <span class="py-docstring">"""</span> </span>
<span class="py-lineno"> 816</span>  <span class="py-line"><span class="py-docstring"> compute vector gradient on grid given complex spectral coefficients.</span> </span>
<span class="py-lineno"> 817</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 818</span>  <span class="py-line"><span class="py-docstring"> @param chispec: rank 1 or 2 numpy complex array with shape</span> </span>
<span class="py-lineno"> 819</span>  <span class="py-line"><span class="py-docstring"> (ntrunc+1)*(ntrunc+2)/2 or ((ntrunc+1)*(ntrunc+2)/2,nt) containing</span> </span>
<span class="py-lineno"> 820</span>  <span class="py-line"><span class="py-docstring"> complex spherical harmonic coefficients (where ntrunc is the</span> </span>
<span class="py-lineno"> 821</span>  <span class="py-line"><span class="py-docstring"> triangular truncation limit and nt is the number of spectral arrays</span> </span>
<span class="py-lineno"> 822</span>  <span class="py-line"><span class="py-docstring"> to be transformed). If chispec is rank 1, nt is assumed to be 1.</span> </span>
<span class="py-lineno"> 823</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 824</span>  <span class="py-line"><span class="py-docstring"> @return: C{B{uchi, vchi}} - rank 2 or 3 numpy float32 arrays containing</span> </span>
<span class="py-lineno"> 825</span>  <span class="py-line"><span class="py-docstring"> gridded zonal and meridional components of the vector gradient.</span> </span>
<span class="py-lineno"> 826</span>  <span class="py-line"><span class="py-docstring"> Shapes are either (nlat,nlon) or (nlat,nlon,nt).</span> </span>
<span class="py-lineno"> 827</span>  <span class="py-line"><span class="py-docstring">        """</span> </span>
<span class="py-lineno"> 828</span>  <span class="py-line"> </span>
<span class="py-lineno"> 829</span>  <span class="py-line"><span class="py-comment"># make sure chispec is rank 1 or 2.</span> </span>
<span class="py-lineno"> 830</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 831</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">len</span><span class="py-op">(</span><span class="py-name">chispec</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">)</span> <span class="py-op">!=</span><span class="py-number">1</span> <span class="py-keyword">and</span> <span class="py-name">len</span><span class="py-op">(</span><span class="py-name">chispec</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">)</span> <span class="py-op">!=</span><span class="py-number">2</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 832</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'getgrad needs rank one or two arrays!'</span> </span>
<span class="py-lineno"> 833</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 834</span>  <span class="py-line"> </span>
<span class="py-lineno"> 835</span>  <span class="py-line"><span class="py-comment"># infer ntrunc from size of chispec (chispec must be rank 1!)</span> </span>
<span class="py-lineno"> 836</span>  <span class="py-line"><span class="py-comment"></span><span class="py-comment"># chispec is assumed to have size (ntrunc+1)*(ntrunc+2)/2</span> </span>
<span class="py-lineno"> 837</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 838</span>  <span class="py-line">        <span class="py-name">ntrunc</span> <span class="py-op">=</span> <span class="py-name">int</span><span class="py-op">(</span><span class="py-op">-</span><span class="py-number">1.5</span> <span class="py-op">+</span> <span class="py-number">0.5</span><span class="py-op">*</span><span class="py-name">math</span><span class="py-op">.</span><span class="py-name">sqrt</span><span class="py-op">(</span><span class="py-number">9.</span><span class="py-op">-</span><span class="py-number">8.</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-number">1.</span><span class="py-op">-</span><span class="py-name">chispec</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span><span class="py-op">)</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 839</span>  <span class="py-line"> </span>
<span class="py-lineno"> 840</span>  <span class="py-line"><span class="py-comment"># number of grids to compute.</span> </span>
<span class="py-lineno"> 841</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 842</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">len</span><span class="py-op">(</span><span class="py-name">chispec</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">)</span> <span class="py-op">==</span> <span class="py-number">1</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 843</span>  <span class="py-line">            <span class="py-name">nt</span> <span class="py-op">=</span> <span class="py-number">1</span> </span>
<span class="py-lineno"> 844</span>  <span class="py-line">            <span class="py-name">chispec</span> <span class="py-op">=</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">reshape</span><span class="py-op">(</span><span class="py-name">chispec</span><span class="py-op">,</span> <span class="py-op">(</span><span class="py-op">(</span><span class="py-name">ntrunc</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">ntrunc</span><span class="py-op">+</span><span class="py-number">2</span><span class="py-op">)</span><span class="py-op">/</span><span class="py-number">2</span><span class="py-op">,</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 845</span>  <span class="py-line">        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 846</span>  <span class="py-line">            <span class="py-name">nt</span> <span class="py-op">=</span> <span class="py-name">chispec</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">1</span><span class="py-op">]</span> </span>
<span class="py-lineno"> 847</span>  <span class="py-line"> </span>
<span class="py-lineno"> 848</span>  <span class="py-line"><span class="py-comment"># convert chispec to divspec.</span> </span>
<span class="py-lineno"> 849</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 850</span>  <span class="py-line">        <span class="py-name">divspec</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">lap</span><span class="py-op">(</span><span class="py-name">chispec</span><span class="py-op">,</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">rsphere</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 851</span>  <span class="py-line">  </span>
<span class="py-lineno"> 852</span>  <span class="py-line"><span class="py-comment"># call getuv, with vrtspec=0, to get uchi,vchi.</span> </span>
<span class="py-lineno"> 853</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 854</span>  <span class="py-line">        <span class="py-name">chispec</span><span class="py-op">[</span><span class="py-op">:</span><span class="py-op">,</span><span class="py-op">:</span><span class="py-op">]</span> <span class="py-op">=</span> <span class="py-number">0.</span> </span>
<span class="py-lineno"> 855</span>  <span class="py-line"> </span>
<span class="py-lineno"> 856</span>  <span class="py-line">        <span class="py-name">uchi</span><span class="py-op">,</span> <span class="py-name">vchi</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-7" class="py-name"><a title="spharm.spharm.Spharmt.getuv" class="py-name" href="#" onclick="doclink('link-7', 'getuv', 'Method spharm.spharm.Spharmt.getuv()=spharm.spharm.Spharmt-class.html#getuv'); return false;">getuv</a></span></span><span class="py-op">(</span><span class="py-name">chispec</span><span class="py-op">,</span> <span class="py-name">divspec</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 857</span>  <span class="py-line"> </span>
<span class="py-lineno"> 858</span>  <span class="py-line">        <span class="py-keyword">return</span> <span class="py-name">uchi</span><span class="py-op">,</span> <span class="py-name">vchi</span> </span>
</div><span class="py-lineno"> 859</span>  <span class="py-line"> </span>
<a name="Spharmt.specsmooth"></a><div id="Spharmt.specsmooth-def"><span class="py-lineno"> 860</span> <a class="py-toggle" href="#" id="Spharmt.specsmooth-toggle" onclick="toggle('Spharmt.specsmooth'); return false;">-</a><span class="py-line">    <span class="py-keyword">def</span> <a class="py-def-name" href="spharm.spharm.Spharmt-class.html#specsmooth">specsmooth</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">datagrid</span><span class="py-op">,</span> <span class="py-param">smooth</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Spharmt.specsmooth-collapsed" style="display:none;" pad="++++" indent="++++++++"></div><div id="Spharmt.specsmooth-expanded"><span class="py-lineno"> 861</span>  <span class="py-line"> </span>
<span class="py-lineno"> 862</span>  <span class="py-line">        <span class="py-docstring">"""</span> </span>
<span class="py-lineno"> 863</span>  <span class="py-line"><span class="py-docstring"> isotropic spectral smoothing on a sphere.</span> </span>
<span class="py-lineno"> 864</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 865</span>  <span class="py-line"><span class="py-docstring"> @param datagrid: rank 2 or 3 numpy float32 array with shape (nlat,nlon) or</span> </span>
<span class="py-lineno"> 866</span>  <span class="py-line"><span class="py-docstring"> (nlat,nlon,nt), where nt is the number of grids to be smoothed.  If</span> </span>
<span class="py-lineno"> 867</span>  <span class="py-line"><span class="py-docstring"> datagrid is rank 2, nt is assumed to be 1.</span> </span>
<span class="py-lineno"> 868</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 869</span>  <span class="py-line"><span class="py-docstring"> @param smooth: rank 1 array of length nlat containing smoothing factors</span> </span>
<span class="py-lineno"> 870</span>  <span class="py-line"><span class="py-docstring"> as a function of total wavenumber.</span> </span>
<span class="py-lineno"> 871</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 872</span>  <span class="py-line"><span class="py-docstring"> @return: C{B{datagrid}} - rank 2 or 3 numpy float32 array with shape</span> </span>
<span class="py-lineno"> 873</span>  <span class="py-line"><span class="py-docstring"> (nlat,nlon) or (nlat,nlon,nt) containing the smoothed grids.</span> </span>
<span class="py-lineno"> 874</span>  <span class="py-line"><span class="py-docstring">        """</span> </span>
<span class="py-lineno"> 875</span>  <span class="py-line"> </span>
<span class="py-lineno"> 876</span>  <span class="py-line"><span class="py-comment"># check that datagrid is rank 2 or 3 with size (self.nlat, self.nlon) or</span> </span>
<span class="py-lineno"> 877</span>  <span class="py-line"><span class="py-comment"></span><span class="py-comment"># (self.nlat, self.nlon, nt) where nt is number of grids to transform.</span> </span>
<span class="py-lineno"> 878</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 879</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">len</span><span class="py-op">(</span><span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">)</span> <span class="py-op">&gt;</span> <span class="py-number">3</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 880</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'specsmooth needs a rank two or three array, got %d'</span> <span class="py-op">%</span> <span class="py-op">(</span><span class="py-name">len</span><span class="py-op">(</span><span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">)</span><span class="py-op">,</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 881</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 882</span>  <span class="py-line"> </span>
<span class="py-lineno"> 883</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span> <span class="py-op">!=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlat</span> <span class="py-keyword">or</span> <span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">1</span><span class="py-op">]</span> <span class="py-op">!=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlon</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 884</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'specsmooth needs an array of size %d by %d, got %d by %d'</span> <span class="py-op">%</span> <span class="py-op">(</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlon</span><span class="py-op">,</span> <span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span><span class="py-op">,</span> <span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">1</span><span class="py-op">]</span><span class="py-op">,</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 885</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 886</span>  <span class="py-line"> </span>
<span class="py-lineno"> 887</span>  <span class="py-line"> </span>
<span class="py-lineno"> 888</span>  <span class="py-line"><span class="py-comment"># make sure smooth is rank 1, same size as datagrid.shape[0]</span> </span>
<span class="py-lineno"> 889</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 890</span>  <span class="py-line">        <span class="py-keyword">if</span> <span class="py-name">len</span><span class="py-op">(</span><span class="py-name">smooth</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">)</span> <span class="py-op">!=</span><span class="py-number">1</span> <span class="py-keyword">or</span> <span class="py-name">smooth</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span> <span class="py-op">!=</span> <span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 891</span>  <span class="py-line">            <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'smooth must be rank 1 and same size as datagrid.shape[0] in specsmooth!'</span> </span>
<span class="py-lineno"> 892</span>  <span class="py-line">            <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 893</span>  <span class="py-line"> </span>
<span class="py-lineno"> 894</span>  <span class="py-line"><span class="py-comment"># grid to spectral transform.</span> </span>
<span class="py-lineno"> 895</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 896</span>  <span class="py-line">        <span class="py-name">nlat</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">nlat</span> </span>
<span class="py-lineno"> 897</span>  <span class="py-line">        <span class="py-name">dataspec</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-8" class="py-name"><a title="spharm.spharm.Spharmt.grdtospec" class="py-name" href="#" onclick="doclink('link-8', 'grdtospec', 'Method spharm.spharm.Spharmt.grdtospec()=spharm.spharm.Spharmt-class.html#grdtospec'); return false;">grdtospec</a></span></span><span class="py-op">(</span><span class="py-name">datagrid</span><span class="py-op">,</span> <span class="py-name">nlat</span><span class="py-op">-</span><span class="py-number">1</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 898</span>  <span class="py-line"> </span>
<span class="py-lineno"> 899</span>  <span class="py-line"><span class="py-comment"># multiply spectral coeffs. by smoothing factor.</span> </span>
<span class="py-lineno"> 900</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 901</span>  <span class="py-line">        <span class="py-name">dataspec</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">multsmoothfact</span><span class="py-op">(</span><span class="py-name">dataspec</span><span class="py-op">,</span> <span class="py-name">smooth</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 902</span>  <span class="py-line"> </span>
<span class="py-lineno"> 903</span>  <span class="py-line"><span class="py-comment"># spectral to grid transform.</span> </span>
<span class="py-lineno"> 904</span>  <span class="py-line"><span class="py-comment"></span>  </span>
<span class="py-lineno"> 905</span>  <span class="py-line">        <span class="py-name">datagrid</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-9" class="py-name"><a title="spharm.spharm.Spharmt.spectogrd" class="py-name" href="#" onclick="doclink('link-9', 'spectogrd', 'Method spharm.spharm.Spharmt.spectogrd()=spharm.spharm.Spharmt-class.html#spectogrd'); return false;">spectogrd</a></span></span><span class="py-op">(</span><span class="py-name">dataspec</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 906</span>  <span class="py-line">  </span>
<span class="py-lineno"> 907</span>  <span class="py-line">        <span class="py-keyword">return</span> <span class="py-name">datagrid</span> </span>
</div></div><span class="py-lineno"> 908</span>  <span class="py-line"> </span>
<a name="regrid"></a><div id="regrid-def"><span class="py-lineno"> 909</span> <a class="py-toggle" href="#" id="regrid-toggle" onclick="toggle('regrid'); return false;">-</a><span class="py-line"><span class="py-keyword">def</span> <a class="py-def-name" href="spharm.spharm-module.html#regrid">regrid</a><span class="py-op">(</span><span class="py-param">grdin</span><span class="py-op">,</span> <span class="py-param">grdout</span><span class="py-op">,</span> <span class="py-param">datagrid</span><span class="py-op">,</span> <span class="py-param">ntrunc</span><span class="py-op">=</span><span class="py-name">None</span><span class="py-op">,</span> <span class="py-param">smooth</span><span class="py-op">=</span><span class="py-name">None</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="regrid-collapsed" style="display:none;" pad="++++" indent="++++"></div><div id="regrid-expanded"><span class="py-lineno"> 910</span>  <span class="py-line">    <span class="py-docstring">"""</span> </span>
<span class="py-lineno"> 911</span>  <span class="py-line"><span class="py-docstring"> regrid data using spectral interpolation, while performing</span> </span>
<span class="py-lineno"> 912</span>  <span class="py-line"><span class="py-docstring"> optional spectral smoothing and/or truncation.</span> </span>
<span class="py-lineno"> 913</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 914</span>  <span class="py-line"><span class="py-docstring"> @param grdin: Spharmt class instance describing input grid.</span> </span>
<span class="py-lineno"> 915</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 916</span>  <span class="py-line"><span class="py-docstring"> @param grdout: Spharmt class instance describing output grid.</span> </span>
<span class="py-lineno"> 917</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 918</span>  <span class="py-line"><span class="py-docstring"> @param datagrid: data on input grid (grdin.nlat x grdin.nlon). If</span> </span>
<span class="py-lineno"> 919</span>  <span class="py-line"><span class="py-docstring"> datagrid is rank 3, last dimension is the number of grids to interpolate.</span> </span>
<span class="py-lineno"> 920</span>  <span class="py-line"><span class="py-docstring"> </span> </span>
<span class="py-lineno"> 921</span>  <span class="py-line"><span class="py-docstring"> @keyword ntrunc:  optional spectral truncation limit for datagrid</span> </span>
<span class="py-lineno"> 922</span>  <span class="py-line"><span class="py-docstring"> (default grdin.nlat-1).</span> </span>
<span class="py-lineno"> 923</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 924</span>  <span class="py-line"><span class="py-docstring"> @keyword smooth: rank 1 array of length grdout.nlat containing smoothing </span> </span>
<span class="py-lineno"> 925</span>  <span class="py-line"><span class="py-docstring"> factors as a function of total wavenumber (default is no smoothing).</span> </span>
<span class="py-lineno"> 926</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 927</span>  <span class="py-line"><span class="py-docstring"> @return: C{B{datagrid}} - interpolated (and optionally smoothed) array(s)</span> </span>
<span class="py-lineno"> 928</span>  <span class="py-line"><span class="py-docstring"> on grdout.nlon x grdout.nlat grid.</span> </span>
<span class="py-lineno"> 929</span>  <span class="py-line"><span class="py-docstring">    """</span> </span>
<span class="py-lineno"> 930</span>  <span class="py-line"> </span>
<span class="py-lineno"> 931</span>  <span class="py-line"><span class="py-comment"># check that datagrid is rank 2 or 3 with size (grdin.nlat, grdin.nlon) or</span> </span>
<span class="py-lineno"> 932</span>  <span class="py-line"><span class="py-comment"></span><span class="py-comment"># (grdin.nlat, grdin.nlon, nt) where nt is number of grids to transform.</span> </span>
<span class="py-lineno"> 933</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 934</span>  <span class="py-line">    <span class="py-keyword">if</span> <span class="py-name">len</span><span class="py-op">(</span><span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">)</span> <span class="py-op">&gt;</span> <span class="py-number">3</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 935</span>  <span class="py-line">        <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'regrid needs a rank two or three array, got %d'</span> <span class="py-op">%</span> <span class="py-op">(</span><span class="py-name">len</span><span class="py-op">(</span><span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">)</span><span class="py-op">,</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 936</span>  <span class="py-line">        <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 937</span>  <span class="py-line"> </span>
<span class="py-lineno"> 938</span>  <span class="py-line">    <span class="py-keyword">if</span> <span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span> <span class="py-op">!=</span> <span class="py-name">grdin</span><span class="py-op">.</span><span class="py-name">nlat</span> <span class="py-keyword">or</span> <span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">1</span><span class="py-op">]</span> <span class="py-op">!=</span> <span class="py-name">grdin</span><span class="py-op">.</span><span class="py-name">nlon</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 939</span>  <span class="py-line">        <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'grdtospec needs an array of size %d by %d, got %d by %d'</span> <span class="py-op">%</span> <span class="py-op">(</span><span class="py-name">grdin</span><span class="py-op">.</span><span class="py-name">nlat</span><span class="py-op">,</span> <span class="py-name">grdin</span><span class="py-op">.</span><span class="py-name">nlon</span><span class="py-op">,</span> <span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span><span class="py-op">,</span> <span class="py-name">datagrid</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">1</span><span class="py-op">]</span><span class="py-op">,</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 940</span>  <span class="py-line">        <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 941</span>  <span class="py-line"> </span>
<span class="py-lineno"> 942</span>  <span class="py-line">    <span class="py-keyword">if</span> <span class="py-name">smooth</span> <span class="py-keyword">and</span> <span class="py-op">(</span><span class="py-name">len</span><span class="py-op">(</span><span class="py-name">smooth</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">)</span> <span class="py-op">!=</span><span class="py-number">1</span> <span class="py-keyword">or</span> <span class="py-name">smooth</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span> <span class="py-op">!=</span> <span class="py-name">grdout</span><span class="py-op">.</span><span class="py-name">nlat</span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 943</span>  <span class="py-line">        <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'smooth must be rank 1 size grdout.nlat in regrid!'</span> </span>
<span class="py-lineno"> 944</span>  <span class="py-line">        <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 945</span>  <span class="py-line"> </span>
<span class="py-lineno"> 946</span>  <span class="py-line">    <span class="py-keyword">if</span> <span class="py-keyword">not</span> <span class="py-name">ntrunc</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 947</span>  <span class="py-line">        <span class="py-name">ntrunc</span> <span class="py-op">=</span> <span class="py-name">min</span><span class="py-op">(</span><span class="py-name">grdout</span><span class="py-op">.</span><span class="py-name">nlat</span><span class="py-op">-</span><span class="py-number">1</span><span class="py-op">,</span><span class="py-name">grdin</span><span class="py-op">.</span><span class="py-name">nlat</span><span class="py-op">-</span><span class="py-number">1</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 948</span>  <span class="py-line"> </span>
<span class="py-lineno"> 949</span>  <span class="py-line">    <span class="py-name">dataspec</span> <span class="py-op">=</span> <span class="py-name">grdin</span><span class="py-op">.</span><span id="link-10" class="py-name"><a title="spharm.spharm.Spharmt.grdtospec" class="py-name" href="#" onclick="doclink('link-10', 'grdtospec', 'Method spharm.spharm.Spharmt.grdtospec()=spharm.spharm.Spharmt-class.html#grdtospec'); return false;">grdtospec</a></span></span><span class="py-op">(</span><span class="py-name">datagrid</span><span class="py-op">,</span><span class="py-name">ntrunc</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 950</span>  <span class="py-line"> </span>
<span class="py-lineno"> 951</span>  <span class="py-line">    <span class="py-keyword">if</span> <span class="py-name">smooth</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 952</span>  <span class="py-line">        <span class="py-name">dataspec</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">multsmoothfact</span><span class="py-op">(</span><span class="py-name">dataspec</span><span class="py-op">,</span> <span class="py-name">smooth</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 953</span>  <span class="py-line"> </span>
<span class="py-lineno"> 954</span>  <span class="py-line">    <span class="py-keyword">return</span> <span class="py-name">grdout</span><span class="py-op">.</span><span id="link-11" class="py-name"><a title="spharm.spharm.Spharmt.spectogrd" class="py-name" href="#" onclick="doclink('link-11', 'spectogrd', 'Method spharm.spharm.Spharmt.spectogrd()=spharm.spharm.Spharmt-class.html#spectogrd'); return false;">spectogrd</a></span></span><span class="py-op">(</span><span class="py-name">dataspec</span><span class="py-op">)</span> </span>
</div><span class="py-lineno"> 955</span>  <span class="py-line"> </span>
<a name="gaussian_lats_wts"></a><div id="gaussian_lats_wts-def"><span class="py-lineno"> 956</span> <a class="py-toggle" href="#" id="gaussian_lats_wts-toggle" onclick="toggle('gaussian_lats_wts'); return false;">-</a><span class="py-line"><span class="py-keyword">def</span> <a class="py-def-name" href="spharm.spharm-module.html#gaussian_lats_wts">gaussian_lats_wts</a><span class="py-op">(</span><span class="py-param">nlat</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="gaussian_lats_wts-collapsed" style="display:none;" pad="++++" indent="++++"></div><div id="gaussian_lats_wts-expanded"><span class="py-lineno"> 957</span>  <span class="py-line"> </span>
<span class="py-lineno"> 958</span>  <span class="py-line">    <span class="py-docstring">"""     </span> </span>
<span class="py-lineno"> 959</span>  <span class="py-line"><span class="py-docstring"> compute the gaussian latitudes (in degrees) and quadrature weights.</span> </span>
<span class="py-lineno"> 960</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 961</span>  <span class="py-line"><span class="py-docstring"> @param nlat: number of gaussian latitudes desired.</span> </span>
<span class="py-lineno"> 962</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 963</span>  <span class="py-line"><span class="py-docstring"> @return: C{B{lats, wts}} - rank 1 numpy float64 arrays containing</span> </span>
<span class="py-lineno"> 964</span>  <span class="py-line"><span class="py-docstring"> gaussian latitudes (in degrees north) and gaussian quadrature weights.</span> </span>
<span class="py-lineno"> 965</span>  <span class="py-line"><span class="py-docstring">    """</span> </span>
<span class="py-lineno"> 966</span>  <span class="py-line"> </span>
<span class="py-lineno"> 967</span>  <span class="py-line"><span class="py-comment"># get the gaussian colatitudes and weights using gaqd.</span> </span>
<span class="py-lineno"> 968</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 969</span>  <span class="py-line">    <span class="py-name">colats</span><span class="py-op">,</span> <span class="py-name">wts</span><span class="py-op">,</span> <span class="py-name">ierror</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">gaqd</span><span class="py-op">(</span><span class="py-name">nlat</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 970</span>  <span class="py-line"> </span>
<span class="py-lineno"> 971</span>  <span class="py-line">    <span class="py-keyword">if</span> <span class="py-name">ierror</span> <span class="py-op">!=</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 972</span>  <span class="py-line">        <span class="py-name">msg</span> <span class="py-op">=</span> <span class="py-string">'In return from call to gaqd ierror =  %d'</span> <span class="py-op">%</span> <span class="py-name">ierror</span> </span>
<span class="py-lineno"> 973</span>  <span class="py-line">        <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-name">msg</span> </span>
<span class="py-lineno"> 974</span>  <span class="py-line"> </span>
<span class="py-lineno"> 975</span>  <span class="py-line"><span class="py-comment"># convert to degrees north latitude.</span> </span>
<span class="py-lineno"> 976</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 977</span>  <span class="py-line">    <span class="py-name">lats</span> <span class="py-op">=</span> <span class="py-number">90.0</span> <span class="py-op">-</span> <span class="py-name">colats</span><span class="py-op">*</span><span class="py-number">180.0</span><span class="py-op">/</span><span class="py-name">math</span><span class="py-op">.</span><span class="py-name">pi</span> </span>
<span class="py-lineno"> 978</span>  <span class="py-line"> </span>
<span class="py-lineno"> 979</span>  <span class="py-line">    <span class="py-keyword">return</span> <span class="py-name">lats</span><span class="py-op">,</span> <span class="py-name">wts</span> </span>
</div><span class="py-lineno"> 980</span>  <span class="py-line"> </span>
<a name="getspecindx"></a><div id="getspecindx-def"><span class="py-lineno"> 981</span> <a class="py-toggle" href="#" id="getspecindx-toggle" onclick="toggle('getspecindx'); return false;">-</a><span class="py-line"><span class="py-keyword">def</span> <a class="py-def-name" href="spharm.spharm-module.html#getspecindx">getspecindx</a><span class="py-op">(</span><span class="py-param">ntrunc</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="getspecindx-collapsed" style="display:none;" pad="++++" indent="++++"></div><div id="getspecindx-expanded"><span class="py-lineno"> 982</span>  <span class="py-line"> </span>
<span class="py-lineno"> 983</span>  <span class="py-line">    <span class="py-docstring">"""</span> </span>
<span class="py-lineno"> 984</span>  <span class="py-line"><span class="py-docstring"> compute indices of zonal wavenumber (indxm) and degree (indxn)</span> </span>
<span class="py-lineno"> 985</span>  <span class="py-line"><span class="py-docstring"> for complex spherical harmonic coefficients.</span> </span>
<span class="py-lineno"> 986</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 987</span>  <span class="py-line"><span class="py-docstring"> @param ntrunc: spherical harmonic triangular truncation limit.</span> </span>
<span class="py-lineno"> 988</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 989</span>  <span class="py-line"><span class="py-docstring"> @return: C{B{indxm, indxn}} - rank 1 numpy Int32 arrays </span> </span>
<span class="py-lineno"> 990</span>  <span class="py-line"><span class="py-docstring"> containing zonal wavenumber (indxm) and degree (indxn) of</span> </span>
<span class="py-lineno"> 991</span>  <span class="py-line"><span class="py-docstring"> spherical harmonic coefficients.</span> </span>
<span class="py-lineno"> 992</span>  <span class="py-line"><span class="py-docstring">    """</span> </span>
<span class="py-lineno"> 993</span>  <span class="py-line"> </span>
<span class="py-lineno"> 994</span>  <span class="py-line">    <span class="py-name">indexn</span> <span class="py-op">=</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">indices</span><span class="py-op">(</span><span class="py-op">(</span><span class="py-name">ntrunc</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">,</span><span class="py-name">ntrunc</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span><span class="py-op">[</span><span class="py-number">1</span><span class="py-op">,</span><span class="py-op">:</span><span class="py-op">,</span><span class="py-op">:</span><span class="py-op">]</span> </span>
<span class="py-lineno"> 995</span>  <span class="py-line">    <span class="py-name">indexm</span> <span class="py-op">=</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">indices</span><span class="py-op">(</span><span class="py-op">(</span><span class="py-name">ntrunc</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">,</span><span class="py-name">ntrunc</span><span class="py-op">+</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">)</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">,</span><span class="py-op">:</span><span class="py-op">,</span><span class="py-op">:</span><span class="py-op">]</span> </span>
<span class="py-lineno"> 996</span>  <span class="py-line">    <span class="py-name">indices</span> <span class="py-op">=</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">nonzero</span><span class="py-op">(</span><span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">greater</span><span class="py-op">(</span><span class="py-name">indexn</span><span class="py-op">,</span> <span class="py-name">indexm</span><span class="py-op">-</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">.</span><span class="py-name">flatten</span><span class="py-op">(</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 997</span>  <span class="py-line">    <span class="py-name">indxn</span> <span class="py-op">=</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">take</span><span class="py-op">(</span><span class="py-name">indexn</span><span class="py-op">.</span><span class="py-name">flatten</span><span class="py-op">(</span><span class="py-op">)</span><span class="py-op">,</span><span class="py-name">indices</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 998</span>  <span class="py-line">    <span class="py-name">indxm</span> <span class="py-op">=</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">take</span><span class="py-op">(</span><span class="py-name">indexm</span><span class="py-op">.</span><span class="py-name">flatten</span><span class="py-op">(</span><span class="py-op">)</span><span class="py-op">,</span><span class="py-name">indices</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 999</span>  <span class="py-line"> </span>
<span class="py-lineno">1000</span>  <span class="py-line">    <span class="py-keyword">return</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">squeeze</span><span class="py-op">(</span><span class="py-name">indxm</span><span class="py-op">)</span><span class="py-op">,</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">squeeze</span><span class="py-op">(</span><span class="py-name">indxn</span><span class="py-op">)</span> </span>
</div><span class="py-lineno">1001</span>  <span class="py-line"> </span>
<a name="getgeodesicpts"></a><div id="getgeodesicpts-def"><span class="py-lineno">1002</span> <a class="py-toggle" href="#" id="getgeodesicpts-toggle" onclick="toggle('getgeodesicpts'); return false;">-</a><span class="py-line"><span class="py-keyword">def</span> <a class="py-def-name" href="spharm.spharm-module.html#getgeodesicpts">getgeodesicpts</a><span class="py-op">(</span><span class="py-param">m</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="getgeodesicpts-collapsed" style="display:none;" pad="++++" indent="++++"></div><div id="getgeodesicpts-expanded"><span class="py-lineno">1003</span>  <span class="py-line">    <span class="py-docstring">"""</span> </span>
<span class="py-lineno">1004</span>  <span class="py-line"><span class="py-docstring"> computes the lat/lon values of the points on the surface of the sphere</span> </span>
<span class="py-lineno">1005</span>  <span class="py-line"><span class="py-docstring"> corresponding to a twenty-sided (icosahedral) geodesic.</span> </span>
<span class="py-lineno">1006</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">1007</span>  <span class="py-line"><span class="py-docstring"> @param m: the number of points on the edge of a single geodesic triangle.</span> </span>
<span class="py-lineno">1008</span>  <span class="py-line"><span class="py-docstring"> There are 10*(m-1)**2+2 total geodesic points, including the poles.</span> </span>
<span class="py-lineno">1009</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">1010</span>  <span class="py-line"><span class="py-docstring"> @return: C{B{lats, lons}} - rank 1 numpy float32 arrays containing</span> </span>
<span class="py-lineno">1011</span>  <span class="py-line"><span class="py-docstring"> the latitudes and longitudes of the geodesic points (in degrees). These</span> </span>
<span class="py-lineno">1012</span>  <span class="py-line"><span class="py-docstring"> points are nearly evenly distributed on the surface of the sphere.</span> </span>
<span class="py-lineno">1013</span>  <span class="py-line"><span class="py-docstring">    """</span> </span>
<span class="py-lineno">1014</span>  <span class="py-line">    <span class="py-name">x</span><span class="py-op">,</span><span class="py-name">y</span><span class="py-op">,</span><span class="py-name">z</span> <span class="py-op">=</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">ihgeod</span><span class="py-op">(</span><span class="py-name">m</span><span class="py-op">)</span> </span>
<span class="py-lineno">1015</span>  <span class="py-line"><span class="py-comment"># convert cartesian coords to lat/lon.    </span> </span>
<span class="py-lineno">1016</span>  <span class="py-line"><span class="py-comment"></span>    <span class="py-name">rad2dg</span> <span class="py-op">=</span> <span class="py-number">180.</span><span class="py-op">/</span><span class="py-name">math</span><span class="py-op">.</span><span class="py-name">pi</span> </span>
<span class="py-lineno">1017</span>  <span class="py-line">    <span class="py-name">r1</span> <span class="py-op">=</span> <span class="py-name">x</span><span class="py-op">*</span><span class="py-name">x</span><span class="py-op">+</span><span class="py-name">y</span><span class="py-op">*</span><span class="py-name">y</span> </span>
<span class="py-lineno">1018</span>  <span class="py-line">    <span class="py-name">r</span> <span class="py-op">=</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">sqrt</span><span class="py-op">(</span><span class="py-name">r1</span><span class="py-op">+</span><span class="py-name">z</span><span class="py-op">*</span><span class="py-name">z</span><span class="py-op">)</span> </span>
<span class="py-lineno">1019</span>  <span class="py-line">    <span class="py-name">r1</span> <span class="py-op">=</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">sqrt</span><span class="py-op">(</span><span class="py-name">r1</span><span class="py-op">)</span>  </span>
<span class="py-lineno">1020</span>  <span class="py-line">    <span class="py-name">xtmp</span> <span class="py-op">=</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">where</span><span class="py-op">(</span><span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">logical_or</span><span class="py-op">(</span><span class="py-name">x</span><span class="py-op">,</span><span class="py-name">y</span><span class="py-op">)</span><span class="py-op">,</span><span class="py-name">x</span><span class="py-op">,</span><span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">ones</span><span class="py-op">(</span><span class="py-name">x</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">,</span><span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">float32</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">1021</span>  <span class="py-line">    <span class="py-name">ztmp</span> <span class="py-op">=</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">where</span><span class="py-op">(</span><span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">logical_or</span><span class="py-op">(</span><span class="py-name">r1</span><span class="py-op">,</span><span class="py-name">z</span><span class="py-op">)</span><span class="py-op">,</span><span class="py-name">z</span><span class="py-op">,</span><span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">ones</span><span class="py-op">(</span><span class="py-name">z</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">,</span><span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">float32</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">1022</span>  <span class="py-line">    <span class="py-name">lons</span> <span class="py-op">=</span> <span class="py-name">rad2dg</span><span class="py-op">*</span><span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">arctan2</span><span class="py-op">(</span><span class="py-name">y</span><span class="py-op">,</span><span class="py-name">xtmp</span><span class="py-op">)</span><span class="py-op">+</span><span class="py-number">180.</span> </span>
<span class="py-lineno">1023</span>  <span class="py-line">    <span class="py-name">lats</span> <span class="py-op">=</span> <span class="py-name">rad2dg</span><span class="py-op">*</span><span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">arctan2</span><span class="py-op">(</span><span class="py-name">r1</span><span class="py-op">,</span><span class="py-name">ztmp</span><span class="py-op">)</span><span class="py-op">-</span><span class="py-number">90.</span> </span>
<span class="py-lineno">1024</span>  <span class="py-line">    <span class="py-name">lat</span> <span class="py-op">=</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">zeros</span><span class="py-op">(</span><span class="py-number">10</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">m</span><span class="py-op">-</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">**</span><span class="py-number">2</span><span class="py-op">+</span><span class="py-number">2</span><span class="py-op">,</span><span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">float32</span><span class="py-op">)</span> </span>
<span class="py-lineno">1025</span>  <span class="py-line">    <span class="py-name">lon</span> <span class="py-op">=</span> <span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">zeros</span><span class="py-op">(</span><span class="py-number">10</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">m</span><span class="py-op">-</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">**</span><span class="py-number">2</span><span class="py-op">+</span><span class="py-number">2</span><span class="py-op">,</span><span class="py-name">numpy</span><span class="py-op">.</span><span class="py-name">float32</span><span class="py-op">)</span> </span>
<span class="py-lineno">1026</span>  <span class="py-line"><span class="py-comment"># first two points are poles.</span> </span>
<span class="py-lineno">1027</span>  <span class="py-line"><span class="py-comment"></span>    <span class="py-name">lat</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span> <span class="py-op">=</span> <span class="py-number">90</span><span class="py-op">;</span> <span class="py-name">lat</span><span class="py-op">[</span><span class="py-number">1</span><span class="py-op">]</span> <span class="py-op">=</span> <span class="py-op">-</span><span class="py-number">90.</span> </span>
<span class="py-lineno">1028</span>  <span class="py-line">    <span class="py-name">lon</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span> <span class="py-op">=</span> <span class="py-number">0.</span><span class="py-op">;</span> <span class="py-name">lon</span><span class="py-op">[</span><span class="py-number">1</span><span class="py-op">]</span> <span class="py-op">=</span> <span class="py-number">0.</span> </span>
<span class="py-lineno">1029</span>  <span class="py-line">    <span class="py-name">lat</span><span class="py-op">[</span><span class="py-number">2</span><span class="py-op">:</span><span class="py-op">]</span> <span class="py-op">=</span> <span class="py-name">lats</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">:</span><span class="py-number">2</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">m</span><span class="py-op">-</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">,</span><span class="py-number">0</span><span class="py-op">:</span><span class="py-name">m</span><span class="py-op">-</span><span class="py-number">1</span><span class="py-op">,</span><span class="py-op">:</span><span class="py-op">]</span><span class="py-op">.</span><span class="py-name">flatten</span><span class="py-op">(</span><span class="py-op">)</span> </span>
<span class="py-lineno">1030</span>  <span class="py-line">    <span class="py-name">lon</span><span class="py-op">[</span><span class="py-number">2</span><span class="py-op">:</span><span class="py-op">]</span> <span class="py-op">=</span> <span class="py-name">lons</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">:</span><span class="py-number">2</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-name">m</span><span class="py-op">-</span><span class="py-number">1</span><span class="py-op">)</span><span class="py-op">,</span><span class="py-number">0</span><span class="py-op">:</span><span class="py-name">m</span><span class="py-op">-</span><span class="py-number">1</span><span class="py-op">,</span><span class="py-op">:</span><span class="py-op">]</span><span class="py-op">.</span><span class="py-name">flatten</span><span class="py-op">(</span><span class="py-op">)</span> </span>
<span class="py-lineno">1031</span>  <span class="py-line">    <span class="py-keyword">return</span> <span class="py-name">lat</span><span class="py-op">,</span><span class="py-name">lon</span> </span>
</div><span class="py-lineno">1032</span>  <span class="py-line"> </span>
<a name="legendre"></a><div id="legendre-def"><span class="py-lineno">1033</span> <a class="py-toggle" href="#" id="legendre-toggle" onclick="toggle('legendre'); return false;">-</a><span class="py-line"><span class="py-keyword">def</span> <a class="py-def-name" href="spharm.spharm-module.html#legendre">legendre</a><span class="py-op">(</span><span class="py-param">lat</span><span class="py-op">,</span><span class="py-param">ntrunc</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="legendre-collapsed" style="display:none;" pad="++++" indent="++++"></div><div id="legendre-expanded"><span class="py-lineno">1034</span>  <span class="py-line">    <span class="py-docstring">"""</span> </span>
<span class="py-lineno">1035</span>  <span class="py-line"><span class="py-docstring"> calculate associated legendre functions for triangular truncation T(ntrunc),</span> </span>
<span class="py-lineno">1036</span>  <span class="py-line"><span class="py-docstring"> at a given latitude.</span> </span>
<span class="py-lineno">1037</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">1038</span>  <span class="py-line"><span class="py-docstring"> @param lat:  the latitude (in degrees) to compute the associate legendre</span> </span>
<span class="py-lineno">1039</span>  <span class="py-line"><span class="py-docstring"> functions.</span> </span>
<span class="py-lineno">1040</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">1041</span>  <span class="py-line"><span class="py-docstring"> @param ntrunc:  the triangular truncation limit.</span> </span>
<span class="py-lineno">1042</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">1043</span>  <span class="py-line"><span class="py-docstring"> @return: C{B{pnm}} - rank 1 numpy float32 array containing the </span> </span>
<span class="py-lineno">1044</span>  <span class="py-line"><span class="py-docstring"> (C{B{ntrunc}}+1)*(C{B{ntrunc}}+2)/2 associated legendre functions at </span> </span>
<span class="py-lineno">1045</span>  <span class="py-line"><span class="py-docstring"> latitude C{B{lat}}. </span> </span>
<span class="py-lineno">1046</span>  <span class="py-line"><span class="py-docstring">    """</span> </span>
<span class="py-lineno">1047</span>  <span class="py-line">    <span class="py-keyword">return</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span class="py-name">getlegfunc</span><span class="py-op">(</span><span class="py-name">lat</span><span class="py-op">,</span><span class="py-name">ntrunc</span><span class="py-op">)</span> </span>
</div><span class="py-lineno">1048</span>  <span class="py-line"> </span>
<a name="specintrp"></a><div id="specintrp-def"><span class="py-lineno">1049</span> <a class="py-toggle" href="#" id="specintrp-toggle" onclick="toggle('specintrp'); return false;">-</a><span class="py-line"><span class="py-keyword">def</span> <a class="py-def-name" href="spharm.spharm-module.html#specintrp">specintrp</a><span class="py-op">(</span><span class="py-param">lon</span><span class="py-op">,</span><span class="py-param">dataspec</span><span class="py-op">,</span><span class="py-param">legfuncs</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="specintrp-collapsed" style="display:none;" pad="++++" indent="++++"></div><div id="specintrp-expanded"><span class="py-lineno">1050</span>  <span class="py-line">    <span class="py-docstring">"""</span> </span>
<span class="py-lineno">1051</span>  <span class="py-line"><span class="py-docstring">    spectral interpolation given spherical harmonic coefficients.</span> </span>
<span class="py-lineno">1052</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">1053</span>  <span class="py-line"><span class="py-docstring">    @param lon: longitude (in degrees) of point on a sphere to interpolate to.</span> </span>
<span class="py-lineno">1054</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">1055</span>  <span class="py-line"><span class="py-docstring">    @param dataspec:  spectral coefficients of function to interpolate.</span> </span>
<span class="py-lineno">1056</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">1057</span>  <span class="py-line"><span class="py-docstring">    @param legfuncs: associated legendre functions with same triangular</span> </span>
<span class="py-lineno">1058</span>  <span class="py-line"><span class="py-docstring">    truncation as C{B{dataspec}} (computed using L{legendre}), computed</span> </span>
<span class="py-lineno">1059</span>  <span class="py-line"><span class="py-docstring">    at latitude of interpolation point.</span> </span>
<span class="py-lineno">1060</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">1061</span>  <span class="py-line"><span class="py-docstring">    @return: C{B{ob}} - interpolated value.</span> </span>
<span class="py-lineno">1062</span>  <span class="py-line"><span class="py-docstring">    """</span> </span>
<span class="py-lineno">1063</span>  <span class="py-line">    <span class="py-name">ntrunc1</span> <span class="py-op">=</span> <span class="py-name">int</span><span class="py-op">(</span><span class="py-op">-</span><span class="py-number">1.5</span> <span class="py-op">+</span> <span class="py-number">0.5</span><span class="py-op">*</span><span class="py-name">math</span><span class="py-op">.</span><span class="py-name">sqrt</span><span class="py-op">(</span><span class="py-number">9.</span><span class="py-op">-</span><span class="py-number">8.</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-number">1.</span><span class="py-op">-</span><span class="py-name">dataspec</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span><span class="py-op">)</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">1064</span>  <span class="py-line">    <span class="py-name">ntrunc2</span> <span class="py-op">=</span> <span class="py-name">int</span><span class="py-op">(</span><span class="py-op">-</span><span class="py-number">1.5</span> <span class="py-op">+</span> <span class="py-number">0.5</span><span class="py-op">*</span><span class="py-name">math</span><span class="py-op">.</span><span class="py-name">sqrt</span><span class="py-op">(</span><span class="py-number">9.</span><span class="py-op">-</span><span class="py-number">8.</span><span class="py-op">*</span><span class="py-op">(</span><span class="py-number">1.</span><span class="py-op">-</span><span class="py-name">legfuncs</span><span class="py-op">.</span><span class="py-name">shape</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span><span class="py-op">)</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">1065</span>  <span class="py-line">    <span class="py-keyword">if</span> <span class="py-name">ntrunc1</span> <span class="py-op">!=</span> <span class="py-name">ntrunc2</span><span class="py-op">:</span> </span>
<span class="py-lineno">1066</span>  <span class="py-line">       <span class="py-keyword">raise</span> <span class="py-name">ValueError</span><span class="py-op">,</span> <span class="py-string">'first dimensions of dataspec and legfuncs in Spharmt.specintrp imply inconsistent spectral truncations - they must be the same!'</span> </span>
<span class="py-lineno">1067</span>  <span class="py-line">    <span class="py-keyword">return</span> <span class="py-name">_spherepack</span><span class="py-op">.</span><span id="link-12" class="py-name"><a title="spharm.spharm.specintrp" class="py-name" href="#" onclick="doclink('link-12', 'specintrp', 'Function spharm.spharm.specintrp()=spharm.spharm-module.html#specintrp'); return false;">specintrp</a></span></span><span class="py-op">(</span><span class="py-op">(</span><span class="py-name">math</span><span class="py-op">.</span><span class="py-name">pi</span><span class="py-op">/</span><span class="py-number">180.</span><span class="py-op">)</span><span class="py-op">*</span><span class="py-name">lon</span><span class="py-op">,</span><span class="py-name">ntrunc1</span><span class="py-op">,</span><span class="py-name">dataspec</span><span class="py-op">,</span><span class="py-name">legfuncs</span><span class="py-op">)</span> </span>
</div><span class="py-lineno">1068</span>  <span class="py-line"> </span><script type="text/javascript">
<!--
expandto(location.href);
// -->
</script>
</pre>
<br />
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th bgcolor="#70b0f0" class="navbar-select"
          >&nbsp;&nbsp;&nbsp;Home&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

      <th class="navbar" width="100%"></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">Generated by Epydoc
        3.0alpha3 on Thu May 17 05:50:26 2007</td>
    <td align="right" class="footer">
      <a href="http://epydoc.sourceforge.net">http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie()
  // -->
</script>
  
</body>
</html>
